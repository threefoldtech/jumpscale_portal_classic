"use strict";window.elFinder=function(e,t){this.time("load");var n=this,e=$(e),r=$("<div/>").append(e.contents()),i=e.attr("style"),s=e.attr("id")||"",o="elfinder-"+(s||Math.random().toString().substr(2,7)),u="mousedown."+o,a="keydown."+o,f="keypress."+o,l=true,c=true,h=["enable","disable","load","open","reload","select","add","remove","change","dblclick","getfile","lockfiles","unlockfiles","dragstart","dragstop"],p={},d="",v={path:"",url:"",tmbUrl:"",disabled:[],separator:"/",archives:[],extract:[],copyOverwrite:true,tmb:false},m={},g=[],y={},b={},w=[],E=[],S=[],x=new n.command(n),T="auto",N=400,C=$(document.createElement("audio")).hide().appendTo("body")[0],k,L=function(e){if(e.init){m={}}else{for(var t in m){if(m.hasOwnProperty(t)&&m[t].mime!="directory"&&m[t].phash==d&&$.inArray(t,E)===-1){delete m[t]}}}d=e.cwd.hash;A(e.files);if(!m[d]){A([e.cwd])}n.lastDir(d)},A=function(e){var t=e.length,r;while(t--){r=e[t];if(r.name&&r.hash&&r.mime){if(!r.phash){var i="volume_"+r.name,s=n.i18n(i);if(i!=s){r.i18=s}}m[r.hash]=r}}},O=function(e){var t=e.keyCode,r=!!(e.ctrlKey||e.metaKey);if(l){$.each(b,function(i,s){if(s.type==e.type&&s.keyCode==t&&s.shiftKey==e.shiftKey&&s.ctrlKey==r&&s.altKey==e.altKey){e.preventDefault();e.stopPropagation();s.callback(e,n);n.debug("shortcut-exec",i+" : "+s.description)}});if(t==9&&!$(e.target).is(":input")){e.preventDefault()}}},M=new Date,_,D;this.api=null;this.newAPI=false;this.oldAPI=false;this.OS=navigator.userAgent.indexOf("Mac")!==-1?"mac":navigator.userAgent.indexOf("Win")!==-1?"win":"other";this.UA=function(){var e=!document.uniqueID&&!window.opera&&!window.sidebar&&window.localStorage&&typeof window.orientation=="undefined";return{ltIE6:typeof window.addEventListener=="undefined"&&typeof document.documentElement.style.maxHeight=="undefined",ltIE7:typeof window.addEventListener=="undefined"&&typeof document.querySelectorAll=="undefined",ltIE8:typeof window.addEventListener=="undefined"&&typeof document.getElementsByClassName=="undefined",IE:document.uniqueID,Firefox:window.sidebar,Opera:window.opera,Webkit:e,Chrome:e&&window.chrome,Safari:e&&!window.chrome,Mobile:typeof window.orientation!="undefined"}}();this.options=$.extend(true,{},this._options,t||{});if(t.ui){this.options.ui=t.ui}if(t.commands){this.options.commands=t.commands}if(t.uiOptions&&t.uiOptions.toolbar){this.options.uiOptions.toolbar=t.uiOptions.toolbar}$.extend(this.options.contextmenu,t.contextmenu);this.requestType=/^(get|post)$/i.test(this.options.requestType)?this.options.requestType.toLowerCase():"get",this.customData=$.isPlainObject(this.options.customData)?this.options.customData:{};this.id=s;this.uploadURL=t.urlUpload||t.url;this.namespace=o;this.lang=this.i18[this.options.lang]&&this.i18[this.options.lang].messages?this.options.lang:"en";D=this.lang=="en"?this.i18["en"]:$.extend(true,{},this.i18["en"],this.i18[this.lang]);this.direction=D.direction;this.messages=D.messages;this.dateFormat=this.options.dateFormat||D.dateFormat;this.fancyFormat=this.options.fancyDateFormat||D.fancyDateFormat;this.today=(new Date(M.getFullYear(),M.getMonth(),M.getDate())).getTime()/1e3;this.yesterday=this.today-86400;_=this.options.UTCDate?"UTC":"";this.getHours="get"+_+"Hours";this.getMinutes="get"+_+"Minutes";this.getSeconds="get"+_+"Seconds";this.getDate="get"+_+"Date";this.getDay="get"+_+"Day";this.getMonth="get"+_+"Month";this.getFullYear="get"+_+"FullYear";this.cssClass="ui-helper-reset ui-helper-clearfix ui-widget ui-widget-content ui-corner-all elfinder elfinder-"+(this.direction=="rtl"?"rtl":"ltr")+" "+this.options.cssClass;this.storage=function(){try{return"localStorage"in window&&window["localStorage"]!==null?n.localStorage:n.cookie}catch(e){return n.cookie}}();this.viewType=this.storage("view")||this.options.defaultView||"icons";this.sortType=this.storage("sortType")||this.options.sortType||"name";this.sortOrder=this.storage("sortOrder")||this.options.sortOrder||"asc";this.sortStickFolders=this.storage("sortStickFolders");if(this.sortStickFolders===null){this.sortStickFolders=!!this.options.sortStickFolders}else{this.sortStickFolders=!!this.sortStickFolders}this.sortRules=$.extend(true,{},this._sortRules,this.options.sortsRules);$.each(this.sortRules,function(e,t){if(typeof t!="function"){delete n.sortRules[e]}});this.compare=$.proxy(this.compare,this);this.notifyDelay=this.options.notifyDelay>0?parseInt(this.options.notifyDelay):500;this.draggable={appendTo:"body",addClasses:true,delay:30,revert:true,refreshPositions:true,cursor:"move",cursorAt:{left:50,top:47},drag:function(e,t){if(!t.helper.data("locked")){t.helper.toggleClass("elfinder-drag-helper-plus",e.shiftKey||e.ctrlKey||e.metaKey)}},start:function(e,t){var n=$.map(t.helper.data("files")||[],function(e){return e||null}),r,i;r=n.length;while(r--){i=n[r];if(m[i].locked){t.helper.addClass("elfinder-drag-helper-plus").data("locked",true);break}}},stop:function(){n.trigger("focus").trigger("dragstop")},helper:function(e,t){var r=this.id?$(this):$(this).parents("[id]:first"),i=$('<div class="elfinder-drag-helper"><span class="elfinder-drag-helper-icon-plus"/></div>'),s=function(e){return'<div class="elfinder-cwd-icon '+n.mime2class(e)+' ui-corner-all"/>'},o,u;n.trigger("dragstart",{target:r[0],originalEvent:e});o=r.is("."+n.res("class","cwdfile"))?n.selected():[n.navId2Hash(r.attr("id"))];i.append(s(m[o[0]].mime)).data("files",o).data("locked",false);if((u=o.length)>1){i.append(s(m[o[u-1]].mime)+'<span class="elfinder-drag-num">'+u+"</span>")}return i}};this.droppable={tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-navbar-dir,.elfinder-cwd-file",hoverClass:this.res("class","adroppable"),drop:function(e,t){var r=$(this),i=$.map(t.helper.data("files")||[],function(e){return e||null}),s=[],o="class",u,a,f,l;if(r.is("."+n.res(o,"cwd"))){a=d}else if(r.is("."+n.res(o,"cwdfile"))){a=r.attr("id")}else if(r.is("."+n.res(o,"navdir"))){a=n.navId2Hash(r.attr("id"))}u=i.length;while(u--){l=i[u];l!=a&&m[l].phash!=a&&s.push(l)}if(s.length){t.helper.hide();n.clipboard(s,!(e.ctrlKey||e.shiftKey||e.metaKey||t.helper.data("locked")));n.exec("paste",a);n.trigger("drop",{files:i})}}};this.enabled=function(){return e.is(":visible")&&l};this.visible=function(){return e.is(":visible")};this.root=function(e){var t=m[e||d],n;while(t&&t.phash){t=m[t.phash]}if(t){return t.hash}while(n in m&&m.hasOwnProperty(n)){t=m[n];if(!t.phash&&!t.mime=="directory"&&t.read){return t.hash}}return""};this.cwd=function(){return m[d]||{}};this.option=function(e){return v[e]||""};this.file=function(e){return m[e]};this.files=function(){return $.extend(true,{},m)};this.parents=function(e){var t=[],n;while(n=this.file(e)){t.unshift(n.hash);e=n.phash}return t};this.path2array=function(e,t){var n,r=[];while(e&&(n=m[e])&&n.hash){r.unshift(t&&n.i18?n.i18:n.name);e=n.phash}return r};this.path=function(e,t){return m[e]&&m[e].path?m[e].path:this.path2array(e,t).join(v.separator)};this.url=function(e){var t=m[e];if(!t||!t.read){return""}if(t.url){return t.url}if(v.url){return v.url+$.map(this.path2array(e),function(e){return encodeURIComponent(e)}).slice(1).join("/")}var n=$.extend({},this.customData,{cmd:"file",target:t.hash});if(this.oldAPI){n.cmd="open";n.current=t.phash}return this.options.url+(this.options.url.indexOf("?")===-1?"?":"&")+$.param(n,true)};this.tmb=function(e){var t=m[e],n=t&&t.tmb&&t.tmb!=1?v["tmbUrl"]+t.tmb:"";if(n&&(this.UA.Opera||this.UA.IE)){n+="?_="+(new Date).getTime()}return n};this.selected=function(){return g.slice(0)};this.selectedFiles=function(){return $.map(g,function(e){return m[e]?$.extend({},m[e]):null})};this.fileByName=function(e,t){var n;for(n in m){if(m.hasOwnProperty(n)&&m[n].phash==t&&m[n].name==e){return m[n]}}};this.validResponse=function(e,t){return t.error||this.rules[this.rules[e]?e:"defaults"](t)};this.request=function(e){var t=this,n=this.options,r=$.Deferred(),i=$.extend({},n.customData,{mimes:n.onlyMimes},e.data||e),s=i.cmd,o=!(e.preventDefault||e.preventFail),u=!(e.preventDefault||e.preventDone),a=$.extend({},e.notify),f=!!e.raw,l=e.syncOnFail,c,e=$.extend({url:n.url,async:true,type:this.requestType,dataType:"json",cache:false,data:i},e.options||{}),h=function(e){e.warning&&t.error(e.warning);s=="open"&&L($.extend(true,{},e));e.removed&&e.removed.length&&t.remove(e);e.added&&e.added.length&&t.add(e);e.changed&&e.changed.length&&t.change(e);t.trigger(s,e);e.sync&&t.sync()},p=function(e,t){var n;switch(t){case"abort":n=e.quiet?"":["errConnect","errAbort"];break;case"timeout":n=["errConnect","errTimeout"];break;case"parsererror":n=["errResponse","errDataNotJSON"];break;default:if(e.status==403){n=["errConnect","errAccess"]}else if(e.status==404){n=["errConnect","errNotFound"]}else{n="errConnect"}}r.reject(n,e,t)},d=function(e){if(f){return r.resolve(e)}if(!e){return r.reject(["errResponse","errDataEmpty"],m)}else if(!$.isPlainObject(e)){return r.reject(["errResponse","errDataNotJSON"],m)}else if(e.error){return r.reject(e.error,m)}else if(!t.validResponse(s,e)){return r.reject("errResponse",m)}e=t.normalize(e);if(!t.api){t.api=e.api||1;t.newAPI=t.api>=2;t.oldAPI=!t.newAPI}if(e.options){v=$.extend({},v,e.options)}if(e.netDrivers){t.netDrivers=e.netDrivers}r.resolve(e);e.debug&&t.debug("backend-debug",e.debug)},m,g;u&&r.done(h);r.fail(function(e){if(e){o?t.error(e):t.debug("error",t.i18n(e))}});if(!s){return r.reject("errCmdReq")}if(l){r.fail(function(e){e&&t.sync()})}if(a.type&&a.cnt){c=setTimeout(function(){t.notify(a);r.always(function(){a.cnt=-(parseInt(a.cnt)||0);t.notify(a)})},t.notifyDelay);r.always(function(){clearTimeout(c)})}if(s=="open"){while(g=S.pop()){if(g.state()=="pending"){g.quiet=true;g.abort()}}}delete e.preventFail;m=this.transport.send(e).fail(p).done(d);if(s=="open"){S.unshift(m);r.always(function(){var e=$.inArray(m,S);e!==-1&&S.splice(e,1)})}return r};this.diff=function(e){var t={},n=[],r=[],i=[],s=function(e){var t=i.length;while(t--){if(i[t].hash==e){return true}}};$.each(e,function(e,n){t[n.hash]=n});$.each(m,function(e,n){!t[e]&&r.push(e)});$.each(t,function(e,t){var r=m[e];if(!r){n.push(t)}else{$.each(t,function(e){if(t[e]!=r[e]){i.push(t);return false}})}});$.each(r,function(e,n){var o=m[n],u=o.phash;if(u&&o.mime=="directory"&&$.inArray(u,r)===-1&&t[u]&&!s(u)){i.push(t[u])}});return{added:n,removed:r,changed:i}};this.sync=function(){var e=this,t=$.Deferred().done(function(){e.trigger("sync")}),n={data:{cmd:"open",init:1,target:d,tree:this.ui.tree?1:0},preventDefault:true},r={data:{cmd:"tree",target:d==this.root()?d:this.file(d).phash},preventDefault:true};$.when(this.request(n),this.request(r)).fail(function(n){t.reject(n);n&&e.request({data:{cmd:"open",target:e.lastDir(""),tree:1,init:1},notify:{type:"open",cnt:1,hideCnt:true},preventDefault:true})}).done(function(n,r){var i=e.diff(n.files.concat(r&&r.tree?r.tree:[]));i.added.push(n.cwd);i.removed.length&&e.remove(i);i.added.length&&e.add(i);i.changed.length&&e.change(i);return t.resolve(i)});return t};this.upload=function(e){return this.transport.upload(e,this)};this.bind=function(e,t){var n;if(typeof t=="function"){e=(""+e).toLowerCase().split(/\s+/);for(n=0;n<e.length;n++){if(y[e[n]]===void 0){y[e[n]]=[]}y[e[n]].push(t)}}return this};this.unbind=function(e,t){var n=y[(""+e).toLowerCase()]||[],r=n.indexOf(t);r>-1&&n.splice(r,1);t=null;return this};this.trigger=function(e,t){var e=e.toLowerCase(),n=y[e]||[],r,i;this.debug("event-"+e,t);if(n.length){e=$.Event(e);for(r=0;r<n.length;r++){e.data=$.extend(true,{},t);try{if(n[r](e,this)===false||e.isDefaultPrevented()){this.debug("event-stoped",e.type);break}}catch(s){window.console&&window.console.log&&window.console.log(s)}}}return this};this.shortcut=function(e){var t,n,r,i,s;if(this.options.allowShortcuts&&e.pattern&&$.isFunction(e.callback)){t=e.pattern.toUpperCase().split(/\s+/);for(i=0;i<t.length;i++){n=t[i];s=n.split("+");r=(r=s.pop()).length==1?r>0?r:r.charCodeAt(0):$.ui.keyCode[r];if(r&&!b[n]){b[n]={keyCode:r,altKey:$.inArray("ALT",s)!=-1,ctrlKey:$.inArray("CTRL",s)!=-1,shiftKey:$.inArray("SHIFT",s)!=-1,type:e.type||"keydown",callback:e.callback,description:e.description,pattern:n}}}}return this};this.shortcuts=function(){var e=[];$.each(b,function(t,r){e.push([r.pattern,n.i18n(r.description)])});return e};this.clipboard=function(e,t){var n=function(){return $.map(w,function(e){return e.hash})};if(e!==void 0){w.length&&this.trigger("unlockfiles",{files:n()});E=[];w=$.map(e||[],function(e){var n=m[e];if(n){E.push(e);return{hash:e,phash:n.phash,name:n.name,mime:n.mime,read:n.read,locked:n.locked,cut:!!t}}return null});this.trigger("changeclipboard",{clipboard:w.slice(0,w.length)});t&&this.trigger("lockfiles",{files:n()})}return w.slice(0,w.length)};this.isCommandEnabled=function(e){return this._commands[e]?$.inArray(e,v.disabled)===-1:false};this.exec=function(e,t,n){return this._commands[e]&&this.isCommandEnabled(e)?this._commands[e].exec(t,n):$.Deferred().reject("No such command")};this.dialog=function(t,n){return $("<div/>").append(t).appendTo(e).elfinderdialog(n)};this.getUI=function(t){return this.ui[t]||e};this.command=function(e){return e===void 0?this._commands:this._commands[e]};this.resize=function(t,n){e.css("width",t).height(n).trigger("resize");this.trigger("resize",{width:e.width(),height:e.height()})};this.restoreSize=function(){this.resize(T,N)};this.show=function(){e.show();this.enable().trigger("show")};this.hide=function(){this.disable().trigger("hide");e.hide()};this.destroy=function(){if(e&&e[0].elfinder){this.trigger("destroy").disable();y={};b={};$(document).add(e).unbind("."+this.namespace);n.trigger=function(){};e.children().remove();e.append(r.contents()).removeClass(this.cssClass).attr("style",i);e[0].elfinder=null;if(k){clearInterval(k)}}};if(!($.fn.selectable&&$.fn.draggable&&$.fn.droppable)){return alert(this.i18n("errJqui"))}if(!e.length){return alert(this.i18n("errNode"))}if(!this.options.url){return alert(this.i18n("errURL"))}$.extend($.ui.keyCode,{F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120});this.dragUpload=false;this.xhrUpload=(typeof XMLHttpRequestUpload!="undefined"||typeof XMLHttpRequestEventTarget!="undefined")&&typeof File!="undefined"&&typeof FormData!="undefined";this.transport={};if(typeof this.options.transport=="object"){this.transport=this.options.transport;if(typeof this.transport.init=="function"){this.transport.init(this)}}if(typeof this.transport.send!="function"){this.transport.send=function(e){return $.ajax(e)}}if(this.transport.upload=="iframe"){this.transport.upload=$.proxy(this.uploads.iframe,this)}else if(typeof this.transport.upload=="function"){this.dragUpload=!!this.options.dragUploadAllow}else if(this.xhrUpload&&!!this.options.dragUploadAllow){this.transport.upload=$.proxy(this.uploads.xhr,this);this.dragUpload=true}else{this.transport.upload=$.proxy(this.uploads.iframe,this)}this.error=function(){var e=arguments[0];return arguments.length==1&&typeof e=="function"?n.bind("error",e):n.trigger("error",{error:e})};$.each(["enable","disable","load","open","reload","select","add","remove","change","dblclick","getfile","lockfiles","unlockfiles","dragstart","dragstop","search","searchend","viewchange"],function(e,t){n[t]=function(){var e=arguments[0];return arguments.length==1&&typeof e=="function"?n.bind(t,e):n.trigger(t,$.isPlainObject(e)?e:{})}});this.enable(function(){if(!l&&n.visible()&&n.ui.overlay.is(":hidden")){l=true;$("texarea:focus,input:focus,button").blur();e.removeClass("elfinder-disabled")}}).disable(function(){c=l;l=false;e.addClass("elfinder-disabled")}).open(function(){g=[]}).select(function(e){g=$.map(e.data.selected||e.data.value||[],function(e){return m[e]?e:null})}).error(function(e){var t={cssClass:"elfinder-dialog-error",title:n.i18n(n.i18n("error")),resizable:false,destroyOnClose:true,buttons:{}};t.buttons[n.i18n(n.i18n("btnClose"))]=function(){$(this).elfinderdialog("close")};n.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-error"/>'+n.i18n(e.data.error),t)}).bind("tree parents",function(e){A(e.data.tree||[])}).bind("tmb",function(e){$.each(e.data.images||[],function(e,t){if(m[e]){m[e].tmb=t}})}).add(function(e){A(e.data.added||[])}).change(function(e){$.each(e.data.changed||[],function(e,t){var n=t.hash;if(m[n].width&&!t.width||m[n].height&&!t.height){m[n].width=undefined;m[n].height=undefined}m[n]=m[n]?$.extend(m[n],t):t})}).remove(function(e){var t=e.data.removed||[],n=t.length,r=function(e){var t=m[e];if(t){if(t.mime=="directory"&&t.dirs){$.each(m,function(t,n){n.phash==e&&r(t)})}delete m[e]}};while(n--){r(t[n])}}).bind("search",function(e){A(e.data.files)}).bind("rm",function(e){var t=C.canPlayType&&C.canPlayType('audio/wav; codecs="1"');t&&t!=""&&t!="no"&&$(C).html('<source src="./sounds/rm.wav" type="audio/wav">')[0].play()});$.each(this.options.handlers,function(e,t){n.bind(e,t)});this.history=new this.history(this);if(typeof this.options.getFileCallback=="function"&&this.commands.getfile){this.bind("dblclick",function(e){e.preventDefault();n.exec("getfile").fail(function(){n.exec("open")})});this.shortcut({pattern:"enter",description:this.i18n("cmdgetfile"),callback:function(){n.exec("getfile").fail(function(){n.exec(n.OS=="mac"?"rename":"open")})}}).shortcut({pattern:"ctrl+enter",description:this.i18n(this.OS=="mac"?"cmdrename":"cmdopen"),callback:function(){n.exec(n.OS=="mac"?"rename":"open")}})}this._commands={};if(!$.isArray(this.options.commands)){this.options.commands=[]}$.each(["open","reload","back","forward","up","home","info","quicklook","getfile","help"],function(e,t){$.inArray(t,n.options.commands)===-1&&n.options.commands.push(t)});$.each(this.options.commands,function(e,t){var r=n.commands[t];if($.isFunction(r)&&!n._commands[t]){r.prototype=x;n._commands[t]=new r;n._commands[t].setup(t,n.options.commandsOptions[t]||{})}});e.addClass(this.cssClass).bind(u,function(){!l&&n.enable()});this.ui={workzone:$("<div/>").appendTo(e).elfinderworkzone(this),navbar:$("<div/>").appendTo(e).elfindernavbar(this,this.options.uiOptions.navbar||{}),contextmenu:$("<div/>").appendTo(e).elfindercontextmenu(this),overlay:$("<div/>").appendTo(e).elfinderoverlay({show:function(){n.disable()},hide:function(){c&&n.enable()}}),cwd:$("<div/>").appendTo(e).elfindercwd(this,this.options.uiOptions.cwd||{}),notify:this.dialog("",{cssClass:"elfinder-dialog-notify",position:{top:"12px",right:"12px"},resizable:false,autoOpen:false,title:"&nbsp;",width:280}),statusbar:$('<div class="ui-widget-header ui-helper-clearfix ui-corner-bottom elfinder-statusbar"/>').hide().appendTo(e)};$.each(this.options.ui||[],function(t,r){var i="elfinder"+r,s=n.options.uiOptions[r]||{};if(!n.ui[r]&&$.fn[i]){n.ui[r]=$("<"+(s.tag||"div")+"/>").appendTo(e)[i](n,s)}});e[0].elfinder=this;this.options.resizable&&$.fn.resizable&&e.resizable({handles:"se",minWidth:300,minHeight:200});if(this.options.width){T=this.options.width}if(this.options.height){N=parseInt(this.options.height)}n.resize(T,N);$(document).bind("click."+this.namespace,function(t){l&&!$(t.target).closest(e).length&&n.disable()}).bind(a+" "+f,O);this.trigger("init").request({data:{cmd:"open",target:n.lastDir(),init:1,tree:this.ui.tree?1:0},preventDone:true,notify:{type:"open",cnt:1,hideCnt:true},freeze:true}).fail(function(){n.trigger("fail").disable().lastDir("");y={};b={};$(document).add(e).unbind("."+this.namespace);n.trigger=function(){}}).done(function(e){n.load().debug("api",n.api);e=$.extend(true,{},e);L(e);n.trigger("open",e)});this.one("load",function(){e.trigger("resize");if(n.options.sync>1e3){k=setInterval(function(){n.sync()},n.options.sync)}})};elFinder.prototype={res:function(e,t){return this.resources[e]&&this.resources[e][t]},i18:{en:{translator:"",language:"English",direction:"ltr",dateFormat:"d.m.Y H:i",fancyDateFormat:"$1 H:i",messages:{}},months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"]},kinds:{unknown:"Unknown",directory:"Folder",symlink:"Alias","symlink-broken":"AliasBroken","application/x-empty":"TextPlain","application/postscript":"Postscript","application/vnd.ms-office":"MsOffice","application/vnd.ms-word":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.document":"MsWord","application/vnd.ms-word.document.macroEnabled.12":"MsWord","application/vnd.openxmlformats-officedocument.wordprocessingml.template":"MsWord","application/vnd.ms-word.template.macroEnabled.12":"MsWord","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":"MsWord","application/vnd.ms-excel":"MsExcel","application/vnd.ms-excel.sheet.macroEnabled.12":"MsExcel","application/vnd.openxmlformats-officedocument.spreadsheetml.template":"MsExcel","application/vnd.ms-excel.template.macroEnabled.12":"MsExcel","application/vnd.ms-excel.sheet.binary.macroEnabled.12":"MsExcel","application/vnd.ms-excel.addin.macroEnabled.12":"MsExcel","application/vnd.ms-powerpoint":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.presentation":"MsPP","application/vnd.ms-powerpoint.presentation.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slideshow":"MsPP","application/vnd.ms-powerpoint.slideshow.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.template":"MsPP","application/vnd.ms-powerpoint.template.macroEnabled.12":"MsPP","application/vnd.ms-powerpoint.addin.macroEnabled.12":"MsPP","application/vnd.openxmlformats-officedocument.presentationml.slide":"MsPP","application/vnd.ms-powerpoint.slide.macroEnabled.12":"MsPP","application/pdf":"PDF","application/xml":"XML","application/vnd.oasis.opendocument.text":"OO","application/vnd.oasis.opendocument.text-template":"OO","application/vnd.oasis.opendocument.text-web":"OO","application/vnd.oasis.opendocument.text-master":"OO","application/vnd.oasis.opendocument.graphics":"OO","application/vnd.oasis.opendocument.graphics-template":"OO","application/vnd.oasis.opendocument.presentation":"OO","application/vnd.oasis.opendocument.presentation-template":"OO","application/vnd.oasis.opendocument.spreadsheet":"OO","application/vnd.oasis.opendocument.spreadsheet-template":"OO","application/vnd.oasis.opendocument.chart":"OO","application/vnd.oasis.opendocument.formula":"OO","application/vnd.oasis.opendocument.database":"OO","application/vnd.oasis.opendocument.image":"OO","application/vnd.openofficeorg.extension":"OO","application/x-shockwave-flash":"AppFlash","application/flash-video":"Flash video","application/x-bittorrent":"Torrent","application/javascript":"JS","application/rtf":"RTF","application/rtfd":"RTF","application/x-font-ttf":"TTF","application/x-font-otf":"OTF","application/x-rpm":"RPM","application/x-web-config":"TextPlain","application/xhtml+xml":"HTML","application/docbook+xml":"DOCBOOK","application/x-awk":"AWK","application/x-gzip":"GZIP","application/x-bzip2":"BZIP","application/zip":"ZIP","application/x-zip":"ZIP","application/x-rar":"RAR","application/x-tar":"TAR","application/x-7z-compressed":"7z","application/x-jar":"JAR","text/plain":"TextPlain","text/x-php":"PHP","text/html":"HTML","text/javascript":"JS","text/css":"CSS","text/rtf":"RTF","text/rtfd":"RTF","text/x-c":"C","text/x-csrc":"C","text/x-chdr":"CHeader","text/x-c++":"CPP","text/x-c++src":"CPP","text/x-c++hdr":"CPPHeader","text/x-shellscript":"Shell","application/x-csh":"Shell","text/x-python":"Python","text/x-java":"Java","text/x-java-source":"Java","text/x-ruby":"Ruby","text/x-perl":"Perl","text/x-sql":"SQL","text/xml":"XML","text/x-comma-separated-values":"CSV","image/x-ms-bmp":"BMP","image/jpeg":"JPEG","image/gif":"GIF","image/png":"PNG","image/tiff":"TIFF","image/x-targa":"TGA","image/vnd.adobe.photoshop":"PSD","image/xbm":"XBITMAP","image/pxm":"PXM","audio/mpeg":"AudioMPEG","audio/midi":"AudioMIDI","audio/ogg":"AudioOGG","audio/mp4":"AudioMPEG4","audio/x-m4a":"AudioMPEG4","audio/wav":"AudioWAV","audio/x-mp3-playlist":"AudioPlaylist","video/x-dv":"VideoDV","video/mp4":"VideoMPEG4","video/mpeg":"VideoMPEG","video/x-msvideo":"VideoAVI","video/quicktime":"VideoMOV","video/x-ms-wmv":"VideoWM","video/x-flv":"VideoFlash","video/x-matroska":"VideoMKV","video/ogg":"VideoOGG"},rules:{defaults:function(e){if(!e||e.added&&!$.isArray(e.added)||e.removed&&!$.isArray(e.removed)||e.changed&&!$.isArray(e.changed)){return false}return true},open:function(e){return e&&e.cwd&&e.files&&$.isPlainObject(e.cwd)&&$.isArray(e.files)},tree:function(e){return e&&e.tree&&$.isArray(e.tree)},parents:function(e){return e&&e.tree&&$.isArray(e.tree)},tmb:function(e){return e&&e.images&&($.isPlainObject(e.images)||$.isArray(e.images))},upload:function(e){return e&&($.isPlainObject(e.added)||$.isArray(e.added))},search:function(e){return e&&e.files&&$.isArray(e.files)}},commands:{},parseUploadData:function(e){var t;if(!$.trim(e)){return{error:["errResponse","errDataEmpty"]}}try{t=$.parseJSON(e)}catch(n){return{error:["errResponse","errDataNotJSON"]}}if(!this.validResponse("upload",t)){return{error:["errResponse"]}}t=this.normalize(t);t.removed=$.map(t.added||[],function(e){return e.hash});return t},iframeCnt:0,uploads:{iframe:function(e,t){var n=t?t:this,r=e.input,i=$.Deferred().fail(function(e){e&&n.error(e)}).done(function(e){e.warning&&n.error(e.warning);e.removed&&n.remove(e);e.added&&n.add(e);e.changed&&n.change(e);n.trigger("upload",e);e.sync&&n.sync()}),s="iframe-"+n.namespace+ ++n.iframeCnt,o=$('<form action="'+n.uploadURL+'" method="post" enctype="multipart/form-data" encoding="multipart/form-data" target="'+s+'" style="display:none"><input type="hidden" name="cmd" value="upload" /></form>'),u=this.UA.IE,a=function(){p&&clearTimeout(p);h&&clearTimeout(h);c&&n.notify({type:"upload",cnt:-l});setTimeout(function(){u&&$('<iframe src="javascript:false;"/>').appendTo(o);o.remove();f.remove()},100)},f=$('<iframe src="'+(u?"javascript:false;":"about:blank")+'" name="'+s+'" style="position:absolute;left:-1000px;top:-1000px" />').bind("load",function(){f.unbind("load").bind("load",function(){var e=n.parseUploadData(f.contents().text());a();e.error?i.reject(e.error):i.resolve(e)});h=setTimeout(function(){c=true;n.notify({type:"upload",cnt:l})},n.options.notifyDelay);if(n.options.iframeTimeout>0){p=setTimeout(function(){a();i.reject([errors.connect,errors.timeout])},n.options.iframeTimeout)}o.submit()}),l,c,h,p;if(r&&$(r).is(":file")&&$(r).val()){o.append(r)}else{return i.reject()}l=r.files?r.files.length:1;o.append('<input type="hidden" name="'+(n.newAPI?"target":"current")+'" value="'+n.cwd().hash+'"/>').append('<input type="hidden" name="html" value="1"/>').append($(r).attr("name","upload[]"));$.each(n.options.onlyMimes||[],function(e,t){o.append('<input type="hidden" name="mimes[]" value="'+t+'"/>')});$.each(n.options.customData,function(e,t){o.append('<input type="hidden" name="'+e+'" value="'+t+'"/>')});o.appendTo("body");f.appendTo("body");return i},xhr:function(e,t){var n=t?t:this,r=$.Deferred().fail(function(e){e&&n.error(e)}).done(function(e){e.warning&&n.error(e.warning);e.removed&&n.remove(e);e.added&&n.add(e);e.changed&&n.change(e);n.trigger("upload",e);e.sync&&n.sync()}).always(function(){c&&clearTimeout(c);f&&n.notify({type:"upload",cnt:-u,progress:100*u})}),i=new XMLHttpRequest,s=new FormData,o=e.input?e.input.files:e.files,u=o.length,a=5,f=false,l=function(){return setTimeout(function(){f=true;n.notify({type:"upload",cnt:u,progress:a*u})},n.options.notifyDelay)},c;if(!u){return r.reject()}i.addEventListener("error",function(){r.reject("errConnect")},false);i.addEventListener("abort",function(){r.reject(["errConnect","errAbort"])},false);i.addEventListener("load",function(){var e=i.status,t;if(e>500){return r.reject("errResponse")}if(e!=200){return r.reject("errConnect")}if(i.readyState!=4){return r.reject(["errConnect","errTimeout"])}if(!i.responseText){return r.reject(["errResponse","errDataEmpty"])}t=n.parseUploadData(i.responseText);t.error?r.reject(t.error):r.resolve(t)},false);i.upload.addEventListener("progress",function(e){var t=a,r;if(e.lengthComputable){r=parseInt(e.loaded*100/e.total);if(r>0&&!c){c=l()}if(r-t>4){a=r;f&&n.notify({type:"upload",cnt:0,progress:(a-t)*u})}}},false);i.open("POST",n.uploadURL,true);s.append("cmd","upload");s.append(n.newAPI?"target":"current",n.cwd().hash);$.each(n.options.customData,function(e,t){s.append(e,t)});$.each(n.options.onlyMimes,function(e,t){s.append("mimes["+e+"]",t)});$.each(o,function(e,t){s.append("upload[]",t)});i.onreadystatechange=function(){if(i.readyState==4&&i.status==0){r.reject(["errConnect","errAbort"])}};i.send(s);if(!this.UA.Safari||!e.files){c=l()}return r}},one:function(e,t){var n=this,r=$.proxy(t,function(e){setTimeout(function(){n.unbind(e.type,r)},3);return t.apply(this,arguments)});return this.bind(e,r)},localStorage:function(e,t){var n=window.localStorage;e="elfinder-"+e+this.id;if(t===null){console.log("remove",e);return n.removeItem(e)}if(t!==void 0){try{n.setItem(e,t)}catch(r){n.clear();n.setItem(e,t)}}return n.getItem(e)},cookie:function(e,t){var n,r,i,s;e="elfinder-"+e+this.id;if(t===void 0){if(document.cookie&&document.cookie!=""){i=document.cookie.split(";");e+="=";for(s=0;s<i.length;s++){i[s]=$.trim(i[s]);if(i[s].substring(0,e.length)==e){return decodeURIComponent(i[s].substring(e.length))}}}return""}r=$.extend({},this.options.cookie);if(t===null){t="";r.expires=-1}if(typeof r.expires=="number"){n=new Date;n.setTime(n.getTime()+r.expires*864e5);r.expires=n}document.cookie=e+"="+encodeURIComponent(t)+"; expires="+r.expires.toUTCString()+(r.path?"; path="+r.path:"")+(r.domain?"; domain="+r.domain:"")+(r.secure?"; secure":"");return t},lastDir:function(e){return this.options.rememberLastDir?this.storage("lastdir",e):""},_node:$("<span/>"),escape:function(e){return this._node.text(e).html()},normalize:function(e){var t=function(e){if(e&&e.hash&&e.name&&e.mime){if(e.mime=="application/x-empty"){e.mime="text/plain"}return e}return null;return e&&e.hash&&e.name&&e.mime?e:null};if(e.files){e.files=$.map(e.files,t)}if(e.tree){e.tree=$.map(e.tree,t)}if(e.added){e.added=$.map(e.added,t)}if(e.changed){e.changed=$.map(e.changed,t)}if(e.api){e.init=true}return e},setSort:function(e,t,n){this.storage("sortType",this.sortType=this.sortRules[e]?e:"name");this.storage("sortOrder",this.sortOrder=/asc|desc/.test(t)?t:"asc");this.storage("sortStickFolders",(this.sortStickFolders=!!n)?1:"");this.trigger("sortchange")},_sortRules:{name:function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())},size:function(e,t){var n=parseInt(e.size)||0,r=parseInt(t.size)||0;return n==r?0:n>r?1:-1;return(parseInt(e.size)||0)>(parseInt(t.size)||0)?1:-1},kind:function(e,t){return e.mime.localeCompare(t.mime)},date:function(e,t){var n=e.ts||e.date,r=t.ts||t.date;return n==r?0:n>r?1:-1}},compare:function(e,t){var n=this,r=n.sortType,i=n.sortOrder=="asc",s=n.sortStickFolders,o=n.sortRules,u=o[r],a=e.mime=="directory",f=t.mime=="directory",l;if(s){if(a&&!f){return-1}else if(!a&&f){return 1}}l=i?u(e,t):u(t,e);return r!="name"&&l==0?l=i?o.name(e,t):o.name(t,e):l},sortFiles:function(e){return e.sort(this.compare)},notify:function(e){var t=e.type,n=this.messages["ntf"+t]?this.i18n("ntf"+t):this.i18n("ntfsmth"),r=this.ui.notify,i=r.children(".elfinder-notify-"+t),s='<div class="elfinder-notify elfinder-notify-{type}"><span class="elfinder-dialog-icon elfinder-dialog-icon-{type}"/><span class="elfinder-notify-msg">{msg}</span> <span class="elfinder-notify-cnt"/><div class="elfinder-notify-progressbar"><div class="elfinder-notify-progress"/></div></div>',o=e.cnt,u=e.progress>=0&&e.progress<=100?e.progress:0,a,f,l;if(!t){return this}if(!i.length){i=$(s.replace(/\{type\}/g,t).replace(/\{msg\}/g,n)).appendTo(r).data("cnt",0);if(u){i.data({progress:0,total:0})}}a=o+parseInt(i.data("cnt"));if(a>0){!e.hideCnt&&i.children(".elfinder-notify-cnt").text("("+a+")");r.is(":hidden")&&r.elfinderdialog("open");i.data("cnt",a);if(u<100&&(f=i.data("total"))>=0&&(l=i.data("progress"))>=0){f=o+parseInt(i.data("total"));l=u+l;u=parseInt(l/f);i.data({progress:l,total:f});r.find(".elfinder-notify-progress").animate({width:(u<100?u:100)+"%"},20)}}else{i.remove();!r.children().length&&r.elfinderdialog("close")}return this},confirm:function(e){var t=false,n={cssClass:"elfinder-dialog-confirm",modal:true,resizable:false,title:this.i18n(e.title||"confirmReq"),buttons:{},close:function(){!t&&e.cancel.callback();$(this).elfinderdialog("destroy")}},r=this.i18n("apllyAll"),i,s;if(e.reject){n.buttons[this.i18n(e.reject.label)]=function(){e.reject.callback(!!(s&&s.prop("checked")));t=true;$(this).elfinderdialog("close")}}n.buttons[this.i18n(e.accept.label)]=function(){e.accept.callback(!!(s&&s.prop("checked")));t=true;$(this).elfinderdialog("close")};n.buttons[this.i18n(e.cancel.label)]=function(){$(this).elfinderdialog("close")};if(e.all){if(e.reject){n.width=370}n.create=function(){s=$('<input type="checkbox" />');$(this).next().children().before($("<label>"+r+"</label>").prepend(s))};n.open=function(){var e=$(this).next(),t=parseInt(e.children(":first").outerWidth()+e.children(":last").outerWidth());if(t>parseInt(e.width())){$(this).closest(".elfinder-dialog").width(t+30)}}}return this.dialog('<span class="elfinder-dialog-icon elfinder-dialog-icon-confirm"/>'+this.i18n(e.text),n)},uniqueName:function(e,t){var n=0,r="",i,s;e=this.i18n(e);t=t||this.cwd().hash;if((i=e.indexOf(".txt"))!=-1){r=".txt";e=e.substr(0,i)}s=e+r;if(!this.fileByName(s,t)){return s}while(n<1e4){s=e+" "+ ++n+r;if(!this.fileByName(s,t)){return s}}return e+Math.random()+r},i18n:function(){var e=this,t=this.messages,n=[],r=[],i=function(t){var n;if(t.indexOf("#")===0){if(n=e.file(t.substr(1))){return n.name}}return t},s,o,u;for(s=0;s<arguments.length;s++){u=arguments[s];if(typeof u=="string"){n.push(i(u))}else if($.isArray(u)){for(o=0;o<u.length;o++){if(typeof u[o]=="string"){n.push(i(u[o]))}}}}for(s=0;s<n.length;s++){if($.inArray(s,r)!==-1){continue}u=n[s];u=t[u]||u;u=u.replace(/\$(\d+)/g,function(e,t){t=s+parseInt(t);if(t>0&&n[t]){r.push(t)}return n[t]||""});n[s]=u}return $.map(n,function(e,t){return $.inArray(t,r)===-1?e:null}).join("<br>")},mime2class:function(e){var t="elfinder-cwd-icon-";e=e.split("/");return t+e[0]+(e[0]!="image"&&e[1]?" "+t+e[1].replace(/(\.|\+)/g,"-"):"")},mime2kind:function(e){var t=typeof e=="object"?e.mime:e,n;if(e.alias){n="Alias"}else if(this.kinds[t]){n=this.kinds[t]}else{if(t.indexOf("text")===0){n="Text"}else if(t.indexOf("image")===0){n="Image"}else if(t.indexOf("audio")===0){n="Audio"}else if(t.indexOf("video")===0){n="Video"}else if(t.indexOf("application")===0){n="App"}else{n=t}}return this.messages["kind"+n]?this.i18n("kind"+n):t;var t=typeof e=="object"?e.mime:e,n=this.kinds[t]||"unknown";if(e.alias){n="Alias"}else if(n=="unknown"){if(t.indexOf("text")===0){n="Text"}else if(t.indexOf("image")===0){n="Image"}else if(t.indexOf("audio")===0){n="Audio"}else if(t.indexOf("video")===0){n="Video"}else if(t.indexOf("application")===0){n="Application"}}return this.i18n(n)},formatDate:function(e,t){var n=this,t=t||e.ts,r=n.i18,i,s,o,u,a,f,l,c,h,p,d;if(n.options.clientFormatDate&&t>0){i=new Date(t*1e3);c=i[n.getHours]();h=c>12?c-12:c;p=i[n.getMinutes]();d=i[n.getSeconds]();u=i[n.getDate]();a=i[n.getDay]();f=i[n.getMonth]()+1;l=i[n.getFullYear]();s=t>=this.yesterday?this.fancyFormat:this.dateFormat;o=s.replace(/[a-z]/gi,function(e){switch(e){case"d":return u>9?u:"0"+u;case"j":return u;case"D":return n.i18n(r.daysShort[a]);case"l":return n.i18n(r.days[a]);case"m":return f>9?f:"0"+f;case"n":return f;case"M":return n.i18n(r.monthsShort[f-1]);case"F":return n.i18n(r.months[f-1]);case"Y":return l;case"y":return(""+l).substr(2);case"H":return c>9?c:"0"+c;case"G":return c;case"g":return h;case"h":return h>9?h:"0"+h;case"a":return c>12?"pm":"am";case"A":return c>12?"PM":"AM";case"i":return p>9?p:"0"+p;case"s":return d>9?d:"0"+d}return e});return t>=this.yesterday?o.replace("$1",this.i18n(t>=this.today?"Today":"Yesterday")):o}else if(e.date){return e.date.replace(/([a-z]+)\s/i,function(e,t){return n.i18n(t)+" "})}return n.i18n("dateUnknown")},perms2class:function(e){var t="";if(!e.read&&!e.write){t="elfinder-na"}else if(!e.read){t="elfinder-wo"}else if(!e.write){t="elfinder-ro"}return t},formatPermissions:function(e){var t=[];e.read&&t.push(this.i18n("read"));e.write&&t.push(this.i18n("write"));return t.length?t.join(" "+this.i18n("and")+" "):this.i18n("noaccess")},formatSize:function(e){var t=1,n="b";if(e=="unknown"){return this.i18n("unknown")}if(e>1073741824){t=1073741824;n="GB"}else if(e>1048576){t=1048576;n="MB"}else if(e>1024){t=1024;n="KB"}e=e/t;return(e>0?t>=1048576?e.toFixed(2):Math.round(e):0)+" "+n},navHash2Id:function(e){return"nav-"+e},navId2Hash:function(e){return typeof e=="string"?e.substr(4):false},log:function(e){window.console&&window.console.log&&window.console.log(e);return this},debug:function(e,t){var n=this.options.debug;if(n=="all"||n===true||$.isArray(n)&&$.inArray(e,n)!=-1){window.console&&window.console.log&&window.console.log("elfinder debug: ["+e+"] ["+this.id+"]",t)}return this},time:function(e){window.console&&window.console.time&&window.console.time(e)},timeEnd:function(e){window.console&&window.console.timeEnd&&window.console.timeEnd(e)}};elFinder.prototype.version="2.0.2";$.fn.elfinder=function(e){if(e=="instance"){return this.getElFinder()}return this.each(function(){var t=typeof e=="string"?e:"";if(!this.elfinder){new elFinder(this,typeof e=="object"?e:{})}switch(t){case"close":case"hide":this.elfinder.hide();break;case"open":case"show":this.elfinder.show();break;case"destroy":this.elfinder.destroy();break}})};$.fn.getElFinder=function(){var e;this.each(function(){if(this.elfinder){e=this.elfinder;return false}});return e};elFinder.prototype._options={url:"",requestType:"get",transport:{},urlUpload:"",dragUploadAllow:"auto",iframeTimeout:0,customData:{},handlers:{},lang:"en",cssClass:"",commands:["open","reload","home","up","back","forward","getfile","quicklook","download","rm","duplicate","rename","mkdir","mkfile","upload","copy","cut","paste","edit","extract","archive","search","info","view","help","resize","sort","netmount"],commandsOptions:{getfile:{onlyURL:false,multiple:false,folders:false,oncomplete:""},upload:{ui:"uploadbutton"},quicklook:{autoplay:true,jplayer:"extensions/jplayer"},edit:{mimes:[],editors:[]},help:{view:["about","shortcuts","help"]}},getFileCallback:null,defaultView:"icons",ui:["toolbar","tree","path","stat"],uiOptions:{toolbar:[["back","forward"],["netmount"],["mkdir","mkfile","upload"],["open","download","getfile"],["info"],["quicklook"],["copy","cut","paste"],["rm"],["duplicate","rename","edit","resize"],["extract","archive"],["search"],["view","sort"],["help"]],tree:{openRootOnLoad:true,syncTree:true},navbar:{minWidth:150,maxWidth:500},cwd:{oldSchool:false}},onlyMimes:[],sortRules:{},sortType:"name",sortOrder:"asc",sortStickFolders:true,clientFormatDate:true,UTCDate:false,dateFormat:"",fancyDateFormat:"",width:"auto",height:400,resizable:true,notifyDelay:500,allowShortcuts:true,rememberLastDir:true,showFiles:30,showThreshold:50,validName:false,sync:0,loadTmbs:5,cookie:{expires:30,domain:"",path:"/",secure:false},contextmenu:{navbar:["open","|","copy","cut","paste","duplicate","|","rm","|","info"],cwd:["reload","back","|","upload","mkdir","mkfile","paste","|","sort","|","info"],files:["getfile","|","open","quicklook","|","download","|","copy","cut","paste","duplicate","|","rm","|","edit","rename","resize","|","archive","extract","|","info"]},debug:["error","warning","event-destroy"]};elFinder.prototype.history=function(e){var t=this,n=true,r=[],i,s=function(){r=[e.cwd().hash];i=0;n=true},o=function(o){if(o&&t.canForward()||!o&&t.canBack()){n=false;return e.exec("open",r[o?++i:--i]).fail(s)}return $.Deferred().reject()};this.canBack=function(){return i>0};this.canForward=function(){return i<r.length-1};this.back=o;this.forward=function(){return o(true)};e.open(function(t){var s=r.length,o=e.cwd().hash;if(n){i>=0&&s>i+1&&r.splice(i+1);r[r.length-1]!=o&&r.push(o);i=r.length-1}n=true}).reload(s)};elFinder.prototype.command=function(e){this.fm=e;this.name="";this.title="";this.state=-1;this.alwaysEnabled=false;this._disabled=false;this.disableOnSearch=false;this.updateOnSelect=true;this._handlers={enable:function(){this.update(void 0,this.value)},disable:function(){this.update(-1,this.value)},"open reload load":function(e){this._disabled=!(this.alwaysEnabled||this.fm.isCommandEnabled(this.name));this.update(void 0,this.value);this.change()}};this.handlers={};this.shortcuts=[];this.options={ui:"button"};this.setup=function(e,t){var n=this,r=this.fm,i,s;this.name=e;this.title=r.messages["cmd"+e]?r.i18n("cmd"+e):e,this.options=$.extend({},this.options,t);this.listeners=[];if(this.updateOnSelect){this._handlers.select=function(){this.update(void 0,this.value)}}$.each($.extend({},n._handlers,n.handlers),function(e,t){r.bind(e,$.proxy(t,n))});for(i=0;i<this.shortcuts.length;i++){s=this.shortcuts[i];s.callback=$.proxy(s.callback||function(){this.exec()},this);!s.description&&(s.description=this.title);r.shortcut(s)}if(this.disableOnSearch){r.bind("search searchend",function(e){n._disabled=e.type=="search";n.update(void 0,n.value)})}this.init()};this.init=function(){};this.exec=function(e,t){return $.Deferred().reject()};this.disabled=function(){return this.state<0};this.enabled=function(){return this.state>-1};this.active=function(){return this.state>0};this.getstate=function(){return-1};this.update=function(e,t){var n=this.state,r=this.value;if(this._disabled){this.state=-1}else{this.state=e!==void 0?e:this.getstate()}this.value=t;if(n!=this.state||r!=this.value){this.change()}};this.change=function(e){var t,n;if(typeof e==="function"){this.listeners.push(e)}else{for(n=0;n<this.listeners.length;n++){t=this.listeners[n];try{t(this.state,this.value)}catch(r){this.fm.debug("error",r)}}}return this};this.hashes=function(t){return t?$.map($.isArray(t)?t:[t],function(t){return e.file(t)?t:null}):e.selected()};this.files=function(e){var t=this.fm;return e?$.map($.isArray(e)?e:[e],function(e){return t.file(e)||null}):t.selectedFiles()}};elFinder.prototype.resources={"class":{hover:"ui-state-hover",active:"ui-state-active",disabled:"ui-state-disabled",draggable:"ui-draggable",droppable:"ui-droppable",adroppable:"elfinder-droppable-active",cwdfile:"elfinder-cwd-file",cwd:"elfinder-cwd",tree:"elfinder-tree",treeroot:"elfinder-navbar-root",navdir:"elfinder-navbar-dir",navdirwrap:"elfinder-navbar-dir-wrapper",navarrow:"elfinder-navbar-arrow",navsubtree:"elfinder-navbar-subtree",navcollapse:"elfinder-navbar-collapsed",navexpand:"elfinder-navbar-expanded",treedir:"elfinder-tree-dir",placedir:"elfinder-place-dir",searchbtn:"elfinder-button-search"},tpl:{perms:'<span class="elfinder-perms"/>',symlink:'<span class="elfinder-symlink"/>',navicon:'<span class="elfinder-nav-icon"/>',navspinner:'<span class="elfinder-navbar-spinner"/>',navdir:'<div class="elfinder-navbar-wrapper"><span id="{id}" class="ui-corner-all elfinder-navbar-dir {cssclass}"><span class="elfinder-navbar-arrow"/><span class="elfinder-navbar-icon"/>{symlink}{permissions}{name}</span><div class="elfinder-navbar-subtree"/></div>'},mimes:{text:["application/x-empty","application/javascript","application/xhtml+xml","audio/x-mp3-playlist","application/x-web-config","application/docbook+xml","application/x-php","application/x-perl","application/x-awk","application/x-config","application/x-csh","application/xml"]},mixin:{make:function(){var e=this.fm,t=this.name,n=e.getUI("cwd"),r=$.Deferred().fail(function(t){n.trigger("unselectall");t&&e.error(t)}).always(function(){f.remove();a.remove();e.enable()}),i="tmp_"+parseInt(Math.random()*1e5),s=e.cwd().hash,o=new Date,u={hash:i,name:e.uniqueName(this.prefix),mime:this.mime,read:true,write:true,date:"Today "+o.getHours()+":"+o.getMinutes()},a=n.trigger("create."+e.namespace,u).find("#"+i),f=$('<input type="text"/>').keydown(function(e){e.stopImmediatePropagation();if(e.keyCode==$.ui.keyCode.ESCAPE){r.reject()}else if(e.keyCode==$.ui.keyCode.ENTER){f.blur()}}).mousedown(function(e){e.stopPropagation()}).blur(function(){var n=$.trim(f.val()),o=f.parent();if(o.length){if(!n){return r.reject("errInvName")}if(e.fileByName(n,s)){return r.reject(["errExists",n])}o.html(e.escape(n));e.lockfiles({files:[i]});e.request({data:{cmd:t,name:n,target:s},notify:{type:t,cnt:1},preventFail:true,syncOnFail:true}).fail(function(e){r.reject(e)}).done(function(e){r.resolve(e)})}});if(this.disabled()||!a.length){return r.reject()}e.disable();a.find(".elfinder-cwd-filename").empty("").append(f.val(u.name));f.select().focus();return r}}};$.fn.dialogelfinder=function(e){var t="elfinderPosition",n="elfinderDestroyOnClose";this.not(".elfinder").each(function(){var r=$(document),i=$('<div class="ui-widget-header dialogelfinder-drag ui-corner-top">'+(e.title||"Files")+"</div>"),s=$('<a href="#" class="dialogelfinder-drag-close ui-corner-all"><span class="ui-icon ui-icon-closethick"/></a>').appendTo(i).click(function(e){e.preventDefault();o.dialogelfinder("close")}),o=$(this).addClass("dialogelfinder").css("position","absolute").hide().appendTo("body").draggable({handle:".dialogelfinder-drag",containment:"window"}).elfinder(e).prepend(i),u=o.elfinder("instance");o.width(parseInt(o.width())||840).data(n,!!e.destroyOnClose).find(".elfinder-toolbar").removeClass("ui-corner-top");e.position&&o.data(t,e.position);e.autoOpen!==false&&$(this).dialogelfinder("open")});if(e=="open"){var r=$(this),i=r.data(t)||{top:parseInt($(document).scrollTop()+($(window).height()<r.height()?2:($(window).height()-r.height())/2)),left:parseInt($(document).scrollLeft()+($(window).width()<r.width()?2:($(window).width()-r.width())/2))},s=100;if(r.is(":hidden")){$("body").find(":visible").each(function(){var e=$(this),t;if(this!==r[0]&&e.css("position")=="absolute"&&(t=parseInt(e.zIndex()))>s){s=t+1}});r.zIndex(s).css(i).show().trigger("resize");setTimeout(function(){r.trigger("resize").mousedown()},200)}}else if(e=="close"){var r=$(this);if(r.is(":visible")){!!r.data(n)?r.elfinder("destroy").remove():r.elfinder("close")}}else if(e=="instance"){return $(this).getElFinder()}return this};if(elFinder&&elFinder.prototype&&typeof elFinder.prototype.i18=="object"){elFinder.prototype.i18.en={translator:"Troex Nevelin &lt;troex@fury.scancode.ru&gt;",language:"English",direction:"ltr",dateFormat:"M d, Y h:i A",fancyDateFormat:"$1 h:i A",messages:{error:"Error",errUnknown:"Unknown error.",errUnknownCmd:"Unknown command.",errJqui:"Invalid jQuery UI configuration. Selectable, draggable and droppable components must be included.",errNode:"elFinder requires DOM Element to be created.",errURL:"Invalid elFinder configuration! URL option is not set.",errAccess:"Access denied.",errConnect:"Unable to connect to backend.",errAbort:"Connection aborted.",errTimeout:"Connection timeout.",errNotFound:"Backend not found.",errResponse:"Invalid backend response.",errConf:"Invalid backend configuration.",errJSON:"PHP JSON module not installed.",errNoVolumes:"Readable volumes not available.",errCmdParams:'Invalid parameters for command "$1".',errDataNotJSON:"Data is not JSON.",errDataEmpty:"Data is empty.",errCmdReq:"Backend request requires command name.",errOpen:'Unable to open "$1".',errNotFolder:"Object is not a folder.",errNotFile:"Object is not a file.",errRead:'Unable to read "$1".',errWrite:'Unable to write into "$1".',errPerm:"Permission denied.",errLocked:'"$1" is locked and can not be renamed, moved or removed.',errExists:'File named "$1" already exists.',errInvName:"Invalid file name.",errFolderNotFound:"Folder not found.",errFileNotFound:"File not found.",errTrgFolderNotFound:'Target folder "$1" not found.',errPopup:"Browser prevented opening popup window. To open file enable it in browser options.",errMkdir:'Unable to create folder "$1".',errMkfile:'Unable to create file "$1".',errRename:'Unable to rename "$1".',errCopyFrom:'Copying files from volume "$1" not allowed.',errCopyTo:'Copying files to volume "$1" not allowed.',errUpload:"Upload error.",errUploadFile:'Unable to upload "$1".',errUploadNoFiles:"No files found for upload.",errUploadTotalSize:"Data exceeds the maximum allowed size.",errUploadFileSize:"File exceeds maximum allowed size.",errUploadMime:"File type not allowed.",errUploadTransfer:'"$1" transfer error.',errNotReplace:'Object "$1" already exists at this location and can not be replaced by object with another type.',errReplace:'Unable to replace "$1".',errSave:'Unable to save "$1".',errCopy:'Unable to copy "$1".',errMove:'Unable to move "$1".',errCopyInItself:'Unable to copy "$1" into itself.',errRm:'Unable to remove "$1".',errRmSrc:"Unable remove source file(s).",errExtract:'Unable to extract files from "$1".',errArchive:"Unable to create archive.",errArcType:"Unsupported archive type.",errNoArchive:"File is not archive or has unsupported archive type.",errCmdNoSupport:"Backend does not support this command.",errReplByChild:"The folder “$1” can’t be replaced by an item it contains.",errArcSymlinks:"For security reason denied to unpack archives contains symlinks or files with not allowed names.",errArcMaxSize:"Archive files exceeds maximum allowed size.",errResize:'Unable to resize "$1".',errResizeDegree:"Invalid rotate degree.",errResizeRotate:"Image dose not rotated.",errResizeSize:"Invalid image size.",errResizeNoChange:"Image size not changed.",errUsupportType:"Unsupported file type.",errNotUTF8Content:'File "$1" is not in UTF-8 and cannot be edited.',errNetMount:'Unable to mount "$1".',errNetMountNoDriver:"Unsupported protocol.",errNetMountFailed:"Mount failed.",errNetMountHostReq:"Host required.",errSessionExpires:"Your session has expired due to inactivity.",errCreatingTempDir:'Unable to create temporary directory: "$1"',errFtpDownloadFile:'Unable to download file from FTP: "$1"',errFtpUploadFile:'Unable to upload file to FTP: "$1"',errFtpMkdir:'Unable to create remote directory on FTP: "$1"',errArchiveExec:'Error while archiving files: "$1"',errExtractExec:'Error while extracting files: "$1"',cmdarchive:"Create archive",cmdback:"Back",cmdcopy:"Copy",cmdcut:"Cut",cmddownload:"Download",cmdduplicate:"Duplicate",cmdedit:"Edit file",cmdextract:"Extract files from archive",cmdforward:"Forward",cmdgetfile:"Select files",cmdhelp:"About this software",cmdhome:"Home",cmdinfo:"Get info",cmdmkdir:"New folder",cmdmkfile:"New text file",cmdopen:"Open",cmdpaste:"Paste",cmdquicklook:"Preview",cmdreload:"Reload",cmdrename:"Rename",cmdrm:"Delete",cmdsearch:"Find files",cmdup:"Go to parent directory",cmdupload:"Upload files",cmdview:"View",cmdresize:"Resize & Rotate",cmdsort:"Sort",cmdnetmount:"Mount network volume",btnClose:"Close",btnSave:"Save",btnRm:"Remove",btnApply:"Apply",btnCancel:"Cancel",btnNo:"No",btnYes:"Yes",btnMount:"Mount",ntfopen:"Open folder",ntffile:"Open file",ntfreload:"Reload folder content",ntfmkdir:"Creating directory",ntfmkfile:"Creating files",ntfrm:"Delete files",ntfcopy:"Copy files",ntfmove:"Move files",ntfprepare:"Prepare to copy files",ntfrename:"Rename files",ntfupload:"Uploading files",ntfdownload:"Downloading files",ntfsave:"Save files",ntfarchive:"Creating archive",ntfextract:"Extracting files from archive",ntfsearch:"Searching files",ntfresize:"Resizing images",ntfsmth:"Doing something",ntfloadimg:"Loading image",ntfnetmount:"Mounting network volume",ntfdim:"Acquiring image dimension",dateUnknown:"unknown",Today:"Today",Yesterday:"Yesterday",Jan:"Jan",Feb:"Feb",Mar:"Mar",Apr:"Apr",May:"May",Jun:"Jun",Jul:"Jul",Aug:"Aug",Sep:"Sep",Oct:"Oct",Nov:"Nov",Dec:"Dec",sortname:"by name",sortkind:"by kind",sortsize:"by size",sortdate:"by date",sortFoldersFirst:"Folders first",confirmReq:"Confirmation required",confirmRm:"Are you sure you want to remove files?<br/>This cannot be undone!",confirmRepl:"Replace old file with new one?",apllyAll:"Apply to all",name:"Name",size:"Size",perms:"Permissions",modify:"Modified",kind:"Kind",read:"read",write:"write",noaccess:"no access",and:"and",unknown:"unknown",selectall:"Select all files",selectfiles:"Select file(s)",selectffile:"Select first file",selectlfile:"Select last file",viewlist:"List view",viewicons:"Icons view",places:"Places",calc:"Calculate",path:"Path",aliasfor:"Alias for",locked:"Locked",dim:"Dimensions",files:"Files",folders:"Folders",items:"Items",yes:"yes",no:"no",link:"Link",searcresult:"Search results",selected:"selected items",about:"About",shortcuts:"Shortcuts",help:"Help",webfm:"Web file manager",ver:"Version",protocolver:"protocol version",homepage:"Project home",docs:"Documentation",github:"Fork us on Github",twitter:"Follow us on twitter",facebook:"Join us on facebook",team:"Team",chiefdev:"chief developer",developer:"developer",contributor:"contributor",maintainer:"maintainer",translator:"translator",icons:"Icons",dontforget:"and don't forget to take your towel",shortcutsof:"Shortcuts disabled",dropFiles:"Drop files here",or:"or",selectForUpload:"Select files to upload",moveFiles:"Move files",copyFiles:"Copy files",rmFromPlaces:"Remove from places",aspectRatio:"Aspect ratio",scale:"Scale",width:"Width",height:"Height",resize:"Resize",crop:"Crop",rotate:"Rotate","rotate-cw":"Rotate 90 degrees CW","rotate-ccw":"Rotate 90 degrees CCW",degree:"°",netMountDialogTitle:"Mount network volume",protocol:"Protocol",host:"Host",port:"Port",user:"User",pass:"Password",kindUnknown:"Unknown",kindFolder:"Folder",kindAlias:"Alias",kindAliasBroken:"Broken alias",kindApp:"Application",kindPostscript:"Postscript document",kindMsOffice:"Microsoft Office document",kindMsWord:"Microsoft Word document",kindMsExcel:"Microsoft Excel document",kindMsPP:"Microsoft Powerpoint presentation",kindOO:"Open Office document",kindAppFlash:"Flash application",kindPDF:"Portable Document Format (PDF)",kindTorrent:"Bittorrent file",kind7z:"7z archive",kindTAR:"TAR archive",kindGZIP:"GZIP archive",kindBZIP:"BZIP archive",kindZIP:"ZIP archive",kindRAR:"RAR archive",kindJAR:"Java JAR file",kindTTF:"True Type font",kindOTF:"Open Type font",kindRPM:"RPM package",kindText:"Text document",kindTextPlain:"Plain text",kindPHP:"PHP source",kindCSS:"Cascading style sheet",kindHTML:"HTML document",kindJS:"Javascript source",kindRTF:"Rich Text Format",kindC:"C source",kindCHeader:"C header source",kindCPP:"C++ source",kindCPPHeader:"C++ header source",kindShell:"Unix shell script",kindPython:"Python source",kindJava:"Java source",kindRuby:"Ruby source",kindPerl:"Perl script",kindSQL:"SQL source",kindXML:"XML document",kindAWK:"AWK source",kindCSV:"Comma separated values",kindDOCBOOK:"Docbook XML document",kindImage:"Image",kindBMP:"BMP image",kindJPEG:"JPEG image",kindGIF:"GIF Image",kindPNG:"PNG Image",kindTIFF:"TIFF image",kindTGA:"TGA image",kindPSD:"Adobe Photoshop image",kindXBITMAP:"X bitmap image",kindPXM:"Pixelmator image",kindAudio:"Audio media",kindAudioMPEG:"MPEG audio",kindAudioMPEG4:"MPEG-4 audio",kindAudioMIDI:"MIDI audio",kindAudioOGG:"Ogg Vorbis audio",kindAudioWAV:"WAV audio",AudioPlaylist:"MP3 playlist",kindVideo:"Video media",kindVideoDV:"DV movie",kindVideoMPEG:"MPEG movie",kindVideoMPEG4:"MPEG-4 movie",kindVideoAVI:"AVI movie",kindVideoMOV:"Quick Time movie",kindVideoWM:"Windows Media movie",kindVideoFlash:"Flash movie",kindVideoMKV:"Matroska movie",kindVideoOGG:"Ogg movie"}}}$.fn.elfinderbutton=function(e){return this.each(function(){var t="class",n=e.fm,r=n.res(t,"disabled"),i=n.res(t,"active"),s=n.res(t,"hover"),o="elfinder-button-menu-item",u="elfinder-button-menu-item-selected",a,f=$(this).addClass("ui-state-default elfinder-button").attr("title",e.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+e.name+'"/>').hover(function(e){!f.is("."+r)&&f[e.type=="mouseleave"?"removeClass":"addClass"](s)}).click(function(t){if(!f.is("."+r)){if(a&&e.variants.length>1){a.is(":hidden")&&e.fm.getUI().click();t.stopPropagation();a.slideToggle(100)}else{e.exec()}}}),l=function(){a.hide()};if($.isArray(e.variants)){f.addClass("elfinder-menubutton");a=$('<div class="ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').hide().appendTo(f).zIndex(12+f.zIndex()).delegate("."+o,"hover",function(){$(this).toggleClass(s)}).delegate("."+o,"click",function(t){t.preventDefault();t.stopPropagation();f.removeClass(s);e.exec(e.fm.selected(),$(this).data("value"))});e.fm.bind("disable select",l).getUI().click(l);e.change(function(){a.html("");$.each(e.variants,function(t,n){a.append($('<div class="'+o+'">'+n[1]+"</div>").data("value",n[0]).addClass(n[0]==e.value?u:""))})})}e.change(function(){if(e.disabled()){f.removeClass(i+" "+s).addClass(r)}else{f.removeClass(r);f[e.active()?"addClass":"removeClass"](i)}}).change()})};$.fn.elfindercontextmenu=function(e){return this.each(function(){var t=$(this).addClass("ui-helper-reset ui-widget ui-state-default ui-corner-all elfinder-contextmenu elfinder-contextmenu-"+e.direction).hide().appendTo("body").delegate(".elfinder-contextmenu-item","mouseenter mouseleave",function(){$(this).toggleClass("ui-state-hover")}),n=e.direction=="ltr"?"left":"right",r=$.extend({},e.options.contextmenu),i='<div class="elfinder-contextmenu-item"><span class="elfinder-button-icon {icon} elfinder-contextmenu-icon"/><span>{label}</span></div>',s=function(e,t,n){return $(i.replace("{icon}",t?"elfinder-button-icon-"+t:"").replace("{label}",e)).click(function(e){e.stopPropagation();e.stopPropagation();n()})},o=function(r,i){var s=$(window),o=t.outerWidth(),u=t.outerHeight(),a=s.width(),f=s.height(),l=s.scrollTop(),c=s.scrollLeft(),h={top:(i+u<f?i:i-u>0?i-u:i)+l,left:(r+o<a?r:r-o)+c,"z-index":100+e.getUI("workzone").zIndex()};t.css(h).show();h={"z-index":h["z-index"]+10};h[n]=parseInt(t.width());t.find(".elfinder-contextmenu-sub").css(h)},u=function(){t.hide().empty()},a=function(n,i){var o=false;$.each(r[n]||[],function(n,r){var a,f,l;if(r=="|"&&o){t.append('<div class="elfinder-contextmenu-separator"/>');o=false;return}a=e.command(r);if(a&&a.getstate(i)!=-1){if(a.variants){if(!a.variants.length){return}f=s(a.title,a.name,function(){});l=$('<div class="ui-corner-all elfinder-contextmenu-sub"/>').appendTo(f.append('<span class="elfinder-contextmenu-arrow"/>'));f.addClass("elfinder-contextmenu-group").hover(function(){l.toggle()});$.each(a.variants,function(e,t){l.append($('<div class="elfinder-contextmenu-item"><span>'+t[1]+"</span></div>").click(function(e){e.stopPropagation();u();a.exec(i,t[0])}))})}else{f=s(a.title,a.name,function(){u();a.exec(i)})}t.append(f);o=true}})},f=function(e){$.each(e,function(e,n){var r;if(n.label&&typeof n.callback=="function"){r=s(n.label,n.icon,function(){u();n.callback()});t.append(r)}})};e.one("load",function(){e.bind("contextmenu",function(e){var n=e.data;u();if(n.type&&n.targets){a(n.type,n.targets)}else if(n.raw){f(n.raw)}t.children().length&&o(n.x,n.y)}).one("destroy",function(){t.remove()}).bind("disable select",u).getUI().click(u)})})};$.fn.elfindercwd=function(e,t){this.not(".elfinder-cwd").each(function(){var n=e.viewType=="list",r="undefined",i="select."+e.namespace,s="unselect."+e.namespace,o="disable."+e.namespace,u="enable."+e.namespace,a="class",f=e.res(a,"cwdfile"),l="."+f,c="ui-selected",h=e.res(a,"disabled"),p=e.res(a,"draggable"),d=e.res(a,"droppable"),v=e.res(a,"hover"),m=e.res(a,"adroppable"),g=f+"-tmp",y=e.options.loadTmbs>0?e.options.loadTmbs:5,b="",w=[],E={icon:'<div id="{hash}" class="'+f+' {permsclass} {dirclass} ui-corner-all" title="{tooltip}"><div class="elfinder-cwd-file-wrapper ui-corner-all"><div class="elfinder-cwd-icon {mime} ui-corner-all" unselectable="on" {style}/>{marker}</div><div class="elfinder-cwd-filename" title="{name}">{name}</div></div>',row:'<tr id="{hash}" class="'+f+' {permsclass} {dirclass}" title="{tooltip}"><td><div class="elfinder-cwd-file-wrapper"><span class="elfinder-cwd-icon {mime}"/>{marker}<span class="elfinder-cwd-filename">{name}</span></div></td><td>{perms}</td><td>{date}</td><td>{size}</td><td>{kind}</td></tr>'},S=e.res("tpl","perms"),x=e.res("tpl","symlink"),T={permsclass:function(t){return e.perms2class(t)},perms:function(t){return e.formatPermissions(t)},dirclass:function(e){return e.mime=="directory"?"directory":""},mime:function(t){return e.mime2class(t.mime)},size:function(t){return e.formatSize(t.size)},date:function(t){return e.formatDate(t)},kind:function(t){return e.mime2kind(t)},marker:function(e){return(e.alias||e.mime=="symlink-broken"?x:"")+(!e.read||!e.write?S:"")},tooltip:function(t){var n=e.formatDate(t)+(t.size>0?" ("+e.formatSize(t.size)+")":"");return t.tooltip?e.escape(t.tooltip).replace(/"/g,"&quot;").replace(/\r/g,"&#13;")+"&#13;"+n:n}},N=function(t){t.name=e.escape(t.name);return E[n?"row":"icon"].replace(/\{([a-z]+)\}/g,function(e,n){return T[n]?T[n](t):t[n]?t[n]:""})},C=false,k=function(e,t){function m(e,t){return e[t+"All"]("[id]:not(."+h+"):not(.elfinder-cwd-parent):first")}var r=$.ui.keyCode,o=e==r.LEFT||e==r.UP,u=J.find("[id]."+c),a=o?"first:":"last",f,l,p,d,v;if(u.length){f=u.filter(o?":first":":last");p=m(f,o?"prev":"next");if(!p.length){l=f}else if(n||e==r.LEFT||e==r.RIGHT){l=p}else{d=f.position().top;v=f.position().left;l=f;if(o){do{l=l.prev("[id]")}while(l.length&&!(l.position().top<d&&l.position().left<=v));if(l.is("."+h)){l=m(l,"next")}}else{do{l=l.next("[id]")}while(l.length&&!(l.position().top>d&&l.position().left>=v));if(l.is("."+h)){l=m(l,"prev")}if(!l.length){p=J.find("[id]:not(."+h+"):last");if(p.position().top>d){l=p}}}}}else{l=J.find("[id]:not(."+h+"):not(.elfinder-cwd-parent):"+(o?"last":"first"))}if(l&&l.length&&!l.is(".elfinder-cwd-parent")){if(t){l=f.add(f[o?"prevUntil":"nextUntil"]("#"+l.attr("id"))).add(l)}else{u.trigger(s)}l.trigger(i);P(l.filter(o?":first":":last"));D()}},L=[],A=function(e){J.find("#"+e).trigger(i)},O=function(){var t=e.cwd().hash;J.find("[id]:not(."+c+"):not(.elfinder-cwd-parent)").trigger(i);L=$.map(e.files(),function(e){return e.phash==t?e.hash:null});D()},M=function(){L=[];J.find("[id]."+c).trigger(s);D()},_=function(){return L},D=function(){e.trigger("select",{selected:L})},P=function(e){var t=e.position().top,n=e.outerHeight(true),r=K.scrollTop(),i=K.innerHeight();if(t+n>r+i){K.scrollTop(parseInt(t+n-i))}else if(t<r){K.scrollTop(t)}},H=[],B=function(e){var t=H.length;while(t--){if(H[t].hash==e){return t}}return-1},j="scroll."+e.namespace,F=function(){var t=[],r=false,s=[],o={},u=J.find("[id]:last"),a=!u.length,f=n?J.children("table").children("tbody"):J,l;if(!H.length){return K.unbind(j)}while((!u.length||u.position().top<=K.height()+K.scrollTop()+e.options.showThreshold)&&(l=H.splice(0,e.options.showFiles)).length){t=$.map(l,function(e){if(e.hash&&e.name){if(e.mime=="directory"){r=true}if(e.tmb){e.tmb===1?s.push(e.hash):o[e.hash]=e.tmb}return N(e)}return null});f.append(t.join(""));u=J.find("[id]:last");a&&J.scrollTop(0)}R(o);s.length&&U(s);r&&q();if(L.length){f.find("[id]:not(."+c+"):not(.elfinder-cwd-parent)").each(function(){var e=this.id;$.inArray(e,L)!==-1&&$(this).trigger(i)})}},I=$.extend({},e.droppable,{over:function(t,n){var r=e.cwd().hash;$.each(n.helper.data("files"),function(t,n){if(e.file(n).phash==r){J.removeClass(m);return false}})}}),q=function(){setTimeout(function(){J.find(".directory:not(."+d+",.elfinder-na,.elfinder-ro)").droppable(e.droppable)},20)},R=function(t){var n=e.option("tmbUrl"),r=true,i;$.each(t,function(e,t){var s=J.find("#"+e);if(s.length){(function(e,t){$("<img/>").load(function(){e.find(".elfinder-cwd-icon").css("background","url('"+t+"') center center no-repeat")}).attr("src",t)})(s,n+t)}else{r=false;if((i=B(e))!=-1){H[i].tmb=t}}});return r},U=function(t){var n=[];if(e.oldAPI){e.request({data:{cmd:"tmb",current:e.cwd().hash},preventFail:true}).done(function(e){if(R(e.images||[])&&e.tmb){U()}});return}n=n=t.splice(0,y);if(n.length){e.request({data:{cmd:"tmb",targets:n},preventFail:true}).done(function(e){if(R(e.images||[])){U(t)}})}},z=function(t){var r=n?J.find("tbody"):J,i=t.length,s=[],o={},u=false,a=function(t){var n=J.find("[id]:first"),r;while(n.length){r=e.file(n.attr("id"));if(!n.is(".elfinder-cwd-parent")&&r&&e.compare(t,r)<0){return n}n=n.next("[id]")}},f=function(t){var n=H.length,r;for(r=0;r<n;r++){if(e.compare(t,H[r])<0){return r}}return n||-1},l,c,h,p;while(i--){l=t[i];c=l.hash;if(J.find("#"+c).length){continue}if((h=a(l))&&h.length){h.before(N(l))}else if((p=f(l))>=0){H.splice(p,0,l)}else{r.append(N(l))}if(J.find("#"+c).length){if(l.mime=="directory"){u=true}else if(l.tmb){l.tmb===1?s.push(c):o[c]=l.tmb}}}R(o);s.length&&U(s);u&&q()},W=function(t){var n=t.length,r,i,s;while(n--){r=t[n];if((i=J.find("#"+r)).length){try{i.detach()}catch(o){e.debug("error",o)}}else if((s=B(r))!=-1){H.splice(s,1)}}},X={name:e.i18n("name"),perm:e.i18n("perms"),mod:e.i18n("modify"),size:e.i18n("size"),kind:e.i18n("kind")},V=function(r,i){var s=e.cwd().hash;M();try{J.children("table,"+l).remove()}catch(o){J.html("")}J.removeClass("elfinder-cwd-view-icons elfinder-cwd-view-list").addClass("elfinder-cwd-view-"+(n?"list":"icons"));K[n?"addClass":"removeClass"]("elfinder-cwd-wrapper-list");n&&J.html('<table><thead><tr class="ui-state-default"><td >'+X.name+"</td><td>"+X.perm+"</td><td>"+X.mod+"</td><td>"+X.size+"</td><td>"+X.kind+"</td></tr></thead><tbody/></table>");H=$.map(r,function(e){return i||e.phash==s?e:null});H=e.sortFiles(H);K.bind(j,F).trigger(j);s=e.cwd().phash;if(t.oldSchool&&s&&!b){var u=$.extend(true,{},e.file(s),{name:"..",mime:"directory"});u=$(N(u)).addClass("elfinder-cwd-parent").bind("mousedown click mouseup touchstart touchmove touchend dblclick mouseenter",function(e){e.preventDefault();e.stopPropagation()}).dblclick(function(){e.exec("open",this.id)});(n?J.find("tbody"):J).prepend(u)}},J=$(this).addClass("ui-helper-clearfix elfinder-cwd").attr("unselectable","on").delegate(l,"click."+e.namespace,function(t){var n=this.id?$(this):$(this).parents("[id]:first"),r=n.prevAll("."+c+":first"),o=n.nextAll("."+c+":first"),u=r.length,a=o.length,f;t.stopImmediatePropagation();if(t.shiftKey&&(u||a)){f=u?n.prevUntil("#"+r.attr("id")):n.nextUntil("#"+o.attr("id"));f.add(n).trigger(i)}else if(t.ctrlKey||t.metaKey){n.trigger(n.is("."+c)?s:i)}else{if($(this).data("touching")&&n.is("."+c)){$(this).data("touching",null);e.dblclick({file:this.id});M()}else{M();n.trigger(i)}}D()}).delegate(l,"dblclick."+e.namespace,function(t){e.dblclick({file:this.id})}).delegate(l,"touchstart."+e.namespace,function(e){$(this).data("touching",true);var t=this.id?$(this):$(this).parents("[id]:first"),n=t.prevAll("."+c+":first").length+t.nextAll("."+c+":first").length;$(this).data("longtap",setTimeout(function(){t.trigger(t.is("."+c)?s:i);D();if(n==0&&t.is("."+c)){t.trigger("click");D()}},500))}).delegate(l,"touchmove."+e.namespace+" touchend."+e.namespace,function(e){clearTimeout($(this).data("longtap"))}).delegate(l,"mouseenter."+e.namespace,function(t){var r=$(this),i=n?r:r.children();if(!r.is("."+g)&&!i.is("."+p+",."+h)){i.draggable(e.draggable)}}).delegate(l,i,function(e){var t=$(this),n=t.attr("id");if(!C&&!t.is("."+h)){t.addClass(c).children().addClass(v);if($.inArray(n,L)===-1){L.push(n)}}}).delegate(l,s,function(e){var t=$(this),n=t.attr("id"),r;if(!C){$(this).removeClass(c).children().removeClass(v);r=$.inArray(n,L);if(r!==-1){L.splice(r,1)}}}).delegate(l,o,function(){var e=$(this).removeClass(c).addClass(h),t=(n?e:e.children()).removeClass(v);e.is("."+d)&&e.droppable("disable");t.is("."+p)&&t.draggable("disable");!n&&t.removeClass(h)}).delegate(l,u,function(){var e=$(this).removeClass(h),t=n?e:e.children();e.is("."+d)&&e.droppable("enable");t.is("."+p)&&t.draggable("enable")}).delegate(l,"scrolltoview",function(){P($(this))}).delegate(l,"hover",function(t){e.trigger("hover",{hash:$(this).attr("id"),type:t.type})}).bind("contextmenu."+e.namespace,function(t){var n=$(t.target).closest("."+f);if(n.length){t.stopPropagation();t.preventDefault();if(!n.is("."+h)){if(!n.is("."+c)){M();n.trigger(i);D()}e.trigger("contextmenu",{type:"files",targets:e.selected(),x:t.clientX,y:t.clientY})}}}).selectable({filter:l,stop:D,selected:function(e,t){$(t.selected).trigger(i)},unselected:function(e,t){$(t.unselected).trigger(s)}}).droppable(I).bind("create."+e.namespace,function(e,t){var r=n?J.find("tbody"):J,i=r.find(".elfinder-cwd-parent"),t=$(N(t)).addClass(g);M();if(i.length){i.after(t)}else{r.prepend(t)}J.scrollTop(0)}).bind("unselectall",M).bind("selectfile",function(e,t){J.find("#"+t).trigger(i);D()}),K=$('<div class="elfinder-cwd-wrapper"/>').bind("contextmenu",function(t){t.preventDefault();e.trigger("contextmenu",{type:"cwd",targets:[e.cwd().hash],x:t.clientX,y:t.clientY})}),Q=function(){var e=0;K.siblings(".elfinder-panel:visible").each(function(){e+=$(this).outerHeight(true)});K.height(Y.height()-e)},G=$(this).parent().resize(Q),Y=G.children(".elfinder-workzone").append(K.append(this));if(e.dragUpload){K[0].addEventListener("dragenter",function(e){e.preventDefault();e.stopPropagation();K.addClass(m)},false);K[0].addEventListener("dragleave",function(e){e.preventDefault();e.stopPropagation();e.target==J[0]&&K.removeClass(m)},false);K[0].addEventListener("dragover",function(e){e.preventDefault();e.stopPropagation()},false);K[0].addEventListener("drop",function(t){t.preventDefault();K.removeClass(m);t.dataTransfer&&t.dataTransfer.files&&t.dataTransfer.files.length&&e.exec("upload",{files:t.dataTransfer.files})},false)}e.bind("open",function(e){V(e.data.files)}).bind("search",function(e){w=e.data.files;V(w,true)}).bind("searchend",function(){w=[];if(b){b="";V(e.files())}}).bind("searchstart",function(e){b=e.data.query}).bind("sortchange",function(){V(b?w:e.files(),!!b)}).bind("viewchange",function(){var t=e.selected(),r=e.storage("view")=="list";if(r!=n){n=r;V(e.files());$.each(t,function(e,t){A(t)});D()}Q()}).add(function(t){var n=e.cwd().hash,r=b?$.map(t.data.added||[],function(e){return e.name.indexOf(b)===-1?null:e}):$.map(t.data.added||[],function(e){return e.phash==n?e:null});z(r)}).change(function(t){var n=e.cwd().hash,r=e.selected(),i;if(b){$.each(t.data.changed||[],function(e,t){W([t.hash]);if(t.name.indexOf(b)!==-1){z([t]);$.inArray(t.hash,r)!==-1&&A(t.hash)}})}else{$.each($.map(t.data.changed||[],function(e){return e.phash==n?e:null}),function(e,t){W([t.hash]);z([t]);$.inArray(t.hash,r)!==-1&&A(t.hash)})}D()}).remove(function(e){W(e.data.removed||[]);D()}).bind("open add search searchend",function(){J.css("height","auto");if(J.outerHeight(true)<K.height()){J.height(K.height()-(J.outerHeight(true)-J.height())-2)}}).dragstart(function(e){var t=$(e.data.target),n=e.data.originalEvent;if(t.is(l)){if(!t.is("."+c)){!(n.ctrlKey||n.metaKey||n.shiftKey)&&M();t.trigger(i);D()}J.droppable("disable")}J.selectable("disable").removeClass(h);C=true}).dragstop(function(){J.selectable("enable").droppable("enable");C=false}).bind("lockfiles unlockfiles",function(e){var t=e.type=="lockfiles"?o:u,n=e.data.files||[],r=n.length;while(r--){J.find("#"+n[r]).trigger(t)}D()}).bind("mkdir mkfile duplicate upload rename archive extract",function(t){var n=e.cwd().hash,r;M();$.each(t.data.added||[],function(e,t){t&&t.phash==n&&A(t.hash)});D()}).shortcut({pattern:"ctrl+a",description:"selectall",callback:O}).shortcut({pattern:"left right up down shift+left shift+right shift+up shift+down",description:"selectfiles",type:"keydown",callback:function(e){k(e.keyCode,e.shiftKey)}}).shortcut({pattern:"home",description:"selectffile",callback:function(e){M();P(J.find("[id]:first").trigger(i));D()}}).shortcut({pattern:"end",description:"selectlfile",callback:function(e){M();P(J.find("[id]:last").trigger(i));D()}})});return this};$.fn.elfinderdialog=function(e){var t;if(typeof e=="string"&&(t=this.closest(".ui-dialog")).length){if(e=="open"){t.css("display")=="none"&&t.fadeIn(120,function(){t.trigger("open")})}else if(e=="close"){t.css("display")!="none"&&t.hide().trigger("close")}else if(e=="destroy"){t.hide().remove()}else if(e=="toTop"){t.trigger("totop")}}e=$.extend({},$.fn.elfinderdialog.defaults,e);this.filter(":not(.ui-dialog-content)").each(function(){var t=$(this).addClass("ui-dialog-content ui-widget-content"),n=t.parent(),r="elfinder-dialog-active",i="elfinder-dialog",s="elfinder-dialog-notify",o="ui-state-hover",u=parseInt(Math.random()*1e6),a=n.children(".elfinder-overlay"),f=$('<div class="ui-dialog-buttonset"/>'),l=$('<div class=" ui-helper-clearfix ui-dialog-buttonpane ui-widget-content"/>').append(f),c=$('<div class="ui-dialog ui-widget ui-widget-content ui-corner-all ui-draggable std42-dialog  '+i+" "+e.cssClass+'"/>').hide().append(t).appendTo(n).draggable({handle:".ui-dialog-titlebar",containment:"document"}).css({width:e.width,height:e.height}).mousedown(function(e){e.stopPropagation();$(document).mousedown();if(!c.is("."+r)){n.find("."+i+":visible").removeClass(r);c.addClass(r).zIndex(h()+1)}}).bind("open",function(){c.trigger("totop");typeof e.open=="function"&&$.proxy(e.open,t[0])();if(!c.is("."+s)){n.find("."+i+":visible").not("."+s).each(function(){var e=$(this),t=parseInt(e.css("top")),n=parseInt(e.css("left")),r=parseInt(c.css("top")),i=parseInt(c.css("left"));if(e[0]!=c[0]&&(t==r||n==i)){c.css({top:t+10+"px",left:n+10+"px"})}})}}).bind("close",function(){var r=n.find(".elfinder-dialog:visible"),i=h();$(this).data("modal")&&a.elfinderoverlay("hide");if(r.length){r.each(function(){var e=$(this);if(e.zIndex()>=i){e.trigger("totop");return false}})}else{setTimeout(function(){n.mousedown().click()},10)}if(typeof e.close=="function"){$.proxy(e.close,t[0])()}else if(e.destroyOnClose){c.hide().remove()}}).bind("totop",function(){$(this).mousedown().find(".ui-button:first").focus().end().find(":text:first").focus();$(this).data("modal")&&a.elfinderoverlay("show");a.zIndex($(this).zIndex())}).data({modal:e.modal}),h=function(){var e=n.zIndex()+10;n.find("."+i+":visible").each(function(){var t;if(this!=c[0]){t=$(this).zIndex();if(t>e){e=t}}});return e},p;if(!e.position){p=parseInt((n.height()-c.outerHeight())/2-42);e.position={top:(p>0?p:0)+"px",left:parseInt((n.width()-c.outerWidth())/2)+"px"}}c.css(e.position);if(e.closeOnEscape){$(document).bind("keyup."+u,function(e){if(e.keyCode==$.ui.keyCode.ESCAPE&&c.is("."+r)){t.elfinderdialog("close");$(document).unbind("keyup."+u)}})}c.prepend($('<div class="ui-dialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix">'+e.title+"</div>").prepend($('<a href="#" class="ui-dialog-titlebar-close ui-corner-all"><span class="ui-icon ui-icon-closethick"/></a>').mousedown(function(e){e.preventDefault();t.elfinderdialog("close")})));$.each(e.buttons,function(e,n){var r=$('<button type="button" class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+e+"</span></button>").click($.proxy(n,t[0])).hover(function(e){$(this)[e.type=="mouseenter"?"focus":"blur"]()}).focus(function(){$(this).addClass(o)}).blur(function(){$(this).removeClass(o)}).keydown(function(e){var t;if(e.keyCode==$.ui.keyCode.ENTER){$(this).click()}else if(e.keyCode==$.ui.keyCode.TAB){t=$(this).next(".ui-button");t.length?t.focus():$(this).parent().children(".ui-button:first").focus()}});f.append(r)});f.children().length&&c.append(l);if(e.resizable&&$.fn.resizable){c.resizable({minWidth:e.minWidth,minHeight:e.minHeight,alsoResize:this})}typeof e.create=="function"&&$.proxy(e.create,this)();e.autoOpen&&t.elfinderdialog("open")});return this};$.fn.elfinderdialog.defaults={cssClass:"",title:"",modal:false,resizable:true,autoOpen:true,closeOnEscape:true,destroyOnClose:false,buttons:{},position:null,width:320,height:"auto",minWidth:200,minHeight:110};$.fn.elfindernavbar=function(e,t){this.not(".elfinder-navbar").each(function(){var n=$(this).addClass("ui-state-default elfinder-navbar"),r=n.parent().resize(function(){n.height(i.height()-s)}),i=r.children(".elfinder-workzone").append(n),s=n.outerHeight()-n.height(),o=e.direction=="ltr",u;if($.fn.resizable){u=n.resizable({handles:o?"e":"w",minWidth:t.minWidth||150,maxWidth:t.maxWidth||500}).bind("resize scroll",function(){var t=e.UA.Opera&&n.scrollLeft()?20:2;u.css({top:parseInt(n.scrollTop())+"px",left:o?"auto":parseInt(n.scrollLeft()+t),right:o?parseInt(n.scrollLeft()-t)*-1:"auto"})}).find(".ui-resizable-handle").zIndex(n.zIndex()+10);if(!o){n.resize(function(){n.css("left",null).css("right",0)})}e.one("open",function(){setTimeout(function(){n.trigger("resize")},150)})}});return this};$.fn.elfinderoverlay=function(e){this.filter(":not(.elfinder-overlay)").each(function(){e=$.extend({},e);$(this).addClass("ui-widget-overlay elfinder-overlay").hide().mousedown(function(e){e.preventDefault();e.stopPropagation()}).data({cnt:0,show:typeof e.show=="function"?e.show:function(){},hide:typeof e.hide=="function"?e.hide:function(){}})});if(e=="show"){var t=this.eq(0),n=t.data("cnt")+1,r=t.data("show");t.data("cnt",n);if(t.is(":hidden")){t.zIndex(t.parent().zIndex()+1);t.show();r()}}if(e=="hide"){var t=this.eq(0),n=t.data("cnt")-1,i=t.data("hide");t.data("cnt",n);if(n==0&&t.is(":visible")){t.hide();i()}}return this};$.fn.elfinderpanel=function(e){return this.each(function(){var t=$(this).addClass("elfinder-panel ui-state-default ui-corner-all"),n="margin-"+(e.direction=="ltr"?"left":"right");e.one("load",function(r){var i=e.getUI("navbar");t.css(n,parseInt(i.outerWidth(true)));i.bind("resize",function(){t.is(":visible")&&t.css(n,parseInt(i.outerWidth(true)))})})})};$.fn.elfinderpath=function(e){return this.each(function(){var t=$(this).addClass("elfinder-path").html("&nbsp;").delegate("a","click",function(t){var n=$(this).attr("href").substr(1);t.preventDefault();n!=e.cwd().hash&&e.exec("open",n)}).prependTo(e.getUI("statusbar").show());e.bind("open searchend",function(){var n=[];$.each(e.parents(e.cwd().hash),function(t,r){n.push('<a href="#'+r+'">'+e.escape(e.file(r).name)+"</a>")});t.html(n.join(e.option("separator")))}).bind("search",function(){t.html(e.i18n("searcresult"))})})};$.fn.elfinderplaces=function(e,t){return this.each(function(){var n=[],r="class",i=e.res(r,"navdir"),s=e.res(r,"navcollapse"),o=e.res(r,"navexpand"),u=e.res(r,"hover"),a=e.res(r,"treeroot"),f=e.res("tpl","navdir"),l=e.res("tpl","perms"),c=$(e.res("tpl","navspinner")),h=function(e){return e.substr(6)},p=function(e){return"place-"+e},d=function(){e.storage("places",n.join(","))},v=function(t){return $(f.replace(/\{id\}/,p(t.hash)).replace(/\{name\}/,e.escape(t.name)).replace(/\{cssclass\}/,e.perms2class(t)).replace(/\{permissions\}/,!t.read||!t.write?l:"").replace(/\{symlink\}/,""))},m=function(t){var r=v(t);if(E.children().length){$.each(E.children(),function(){var e=$(this);if(t.name.localeCompare(e.children("."+i).text())<0){return!r.insertBefore(e)}})}n.push(t.hash);!r.parent().length&&E.append(r);w.addClass(s);r.draggable({appendTo:"body",revert:false,helper:function(){var t=$(this);t.children().removeClass("ui-state-hover");return $('<div class="elfinder-place-drag elfinder-'+e.direction+'"/>').append(t.clone()).data("hash",h(t.children(":first").attr("id")))},start:function(){$(this).hide()},stop:function(e,t){var n=S.offset().top,r=S.offset().left,i=S.width(),s=S.height(),o=e.clientX,u=e.clientY;if(o>r&&o<r+i&&u>n&&u<u+s){$(this).show()}else{g(t.helper.data("hash"));d()}}})},g=function(e){var t=$.inArray(e,n);if(t!==-1){n.splice(t,1);E.find("#"+p(e)).parent().remove();!E.children().length&&w.removeClass(s+" "+o)}},y=function(){E.empty();w.removeClass(s+" "+o)},b=v({hash:"root-"+e.namespace,name:e.i18n(t.name,"places"),read:true,write:true}),w=b.children("."+i).addClass(a).click(function(){if(w.is("."+s)){S.toggleClass(o);E.slideToggle();e.storage("placesState",S.is("."+o)?1:0)}}),E=b.children("."+e.res(r,"navsubtree")),S=$(this).addClass(e.res(r,"tree")+" elfinder-places ui-corner-all").hide().append(b).appendTo(e.getUI("navbar")).delegate("."+i,"hover",function(){$(this).toggleClass("ui-state-hover")}).delegate("."+i,"click",function(t){e.exec("open",$(this).attr("id").substr(6))}).delegate("."+i+":not(."+a+")","contextmenu",function(t){var n=$(this).attr("id").substr(6);t.preventDefault();e.trigger("contextmenu",{raw:[{label:e.i18n("rmFromPlaces"),icon:"rm",callback:function(){g(n);d()}}],x:t.clientX,y:t.clientY})}).droppable({tolerance:"pointer",accept:".elfinder-cwd-file-wrapper,.elfinder-tree-dir,.elfinder-cwd-file",hoverClass:e.res("class","adroppable"),drop:function(t,r){var i=true;$.each(r.helper.data("files"),function(t,r){var s=e.file(r);if(s&&s.mime=="directory"&&$.inArray(s.hash,n)===-1){m(s)}else{i=false}});d();i&&r.helper.hide()}});e.one("load",function(){if(e.oldAPI){return}S.show().parent().show();n=$.map(e.storage("places").split(","),function(e){return e||null});if(n.length){w.prepend(c);e.request({data:{cmd:"info",targets:n},preventDefault:true}).done(function(t){n=[];$.each(t.files,function(e,t){t.mime=="directory"&&m(t)});d();if(e.storage("placesState")>0){w.click()}}).always(function(){c.remove()})}e.remove(function(e){$.each(e.data.removed,function(e,t){g(t)});d()}).change(function(e){$.each(e.data.changed,function(e,t){if($.inArray(t.hash,n)!==-1){g(t.hash);t.mime=="directory"&&m(t)}});d()}).bind("sync",function(){if(n.length){w.prepend(c);e.request({data:{cmd:"info",targets:n},preventDefault:true}).done(function(e){$.each(e.files||[],function(e,t){if($.inArray(t.hash,n)===-1){g(t.hash)}});d()}).always(function(){c.remove()})}})})})};$.fn.elfindersearchbutton=function(e){return this.each(function(){var t=false,n=$(this).hide().addClass("ui-widget-content elfinder-button "+e.fm.res("class","searchbtn")+""),r=function(){var n=$.trim(s.val());if(n){e.exec(n).done(function(){t=true;s.focus()})}else{e.fm.trigger("searchend")}},i=function(){s.val("");if(t){t=false;e.fm.trigger("searchend")}},s=$('<input type="text" size="42"/>').appendTo(n).keypress(function(e){e.stopPropagation()}).keydown(function(e){e.stopPropagation();e.keyCode==13&&r();if(e.keyCode==27){e.preventDefault();i()}});$('<span class="ui-icon ui-icon-search" title="'+e.title+'"/>').appendTo(n).click(r);$('<span class="ui-icon ui-icon-close"/>').appendTo(n).click(i);setTimeout(function(){n.parent().detach();e.fm.getUI("toolbar").prepend(n.show());if(e.fm.UA.ltIE7){var t=n.children(e.fm.direction=="ltr"?".ui-icon-close":".ui-icon-search");t.css({right:"",left:parseInt(n.width())-t.outerWidth(true)})}},200);e.fm.error(function(){s.unbind("keydown")}).select(function(){s.blur()}).bind("searchend",function(){s.val("")}).viewchange(i).shortcut({pattern:"ctrl+f f3",description:e.title,callback:function(){s.select().focus()}})})};$.fn.elfindersortbutton=function(e){return this.each(function(){var t=e.fm,n=e.name,r="class",i=t.res(r,"disabled"),s=t.res(r,"hover"),o="elfinder-button-menu-item",u=o+"-selected",a=u+"-asc",f=u+"-desc",l=$(this).addClass("ui-state-default elfinder-button elfinder-menubutton elfiner-button-"+n).attr("title",e.title).append('<span class="elfinder-button-icon elfinder-button-icon-'+n+'"/>').hover(function(e){!l.is("."+i)&&l.toggleClass(s)}).click(function(t){if(!l.is("."+i)){t.stopPropagation();c.is(":hidden")&&e.fm.getUI().click();c.slideToggle(100)}}),c=$('<div class="ui-widget ui-widget-content elfinder-button-menu ui-corner-all"/>').hide().appendTo(l).zIndex(12+l.zIndex()).delegate("."+o,"hover",function(){$(this).toggleClass(s)}).delegate("."+o,"click",function(e){e.preventDefault();e.stopPropagation();p()}),h=function(){c.children(":not(:last)").removeClass(u+" "+a+" "+f).filter('[rel="'+t.sortType+'"]').addClass(u+" "+(t.sortOrder=="asc"?a:f));c.children(":last").toggleClass(u,t.sortStickFolders)},p=function(){c.hide()};$.each(t.sortRules,function(e,n){c.append($('<div class="'+o+'" rel="'+e+'"><span class="ui-icon ui-icon-arrowthick-1-n"/><span class="ui-icon ui-icon-arrowthick-1-s"/>'+t.i18n("sort"+e)+"</div>").data("type",e))});c.children().click(function(n){var r=$(this).attr("rel");e.exec([],{type:r,order:r==t.sortType?t.sortOrder=="asc"?"desc":"asc":t.sortOrder,stick:t.sortStickFolders})});$('<div class="'+o+" "+o+'-separated"><span class="ui-icon ui-icon-check"/>'+t.i18n("sortFoldersFirst")+"</div>").appendTo(c).click(function(){e.exec([],{type:t.sortType,order:t.sortOrder,stick:!t.sortStickFolders})});t.bind("disable select",p).getUI().click(p);t.bind("sortchange",h);if(c.children().length>1){e.change(function(){l.toggleClass(i,e.disabled());h()}).change()}else{l.addClass(i)}})};$.fn.elfinderstat=function(e){return this.each(function(){var t=$(this).addClass("elfinder-stat-size"),n=$('<div class="elfinder-stat-selected"/>'),r=e.i18n("size").toLowerCase(),i=e.i18n("items").toLowerCase(),s=e.i18n("selected"),o=function(n,s){var o=0,u=0;$.each(n,function(e,t){if(!s||t.phash==s){o++;u+=parseInt(t.size)||0}});t.html(i+": "+o+", "+r+": "+e.formatSize(u))};e.getUI("statusbar").prepend(t).append(n).show();e.bind("open reload add remove change searchend",function(){o(e.files(),e.cwd().hash)}).search(function(e){o(e.data.files)}).select(function(){var t=0,i=0,o=e.selectedFiles();if(o.length==1){t=o[0].size;n.html(e.escape(o[0].name)+(t>0?", "+e.formatSize(t):""));return}$.each(o,function(e,n){i++;t+=parseInt(n.size)||0});n.html(i?s+": "+i+", "+r+": "+e.formatSize(t):"&nbsp;")})})};$.fn.elfindertoolbar=function(e,t){this.not(".elfinder-toolbar").each(function(){var n=e._commands,r=$(this).addClass("ui-helper-clearfix ui-widget-header ui-corner-top elfinder-toolbar"),i=t||[],s=i.length,o,u,a,f;r.prev().length&&r.parent().prepend(this);while(s--){if(i[s]){a=$('<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>');o=i[s].length;while(o--){if(u=n[i[s][o]]){f="elfinder"+u.options.ui;$.fn[f]&&a.prepend($("<div/>")[f](u))}}a.children().length&&r.prepend(a);a.children(":gt(0)").before('<span class="ui-widget-content elfinder-toolbar-button-separator"/>')}}r.children().length&&r.show()});return this};$.fn.elfindertree=function(e,t){var n=e.res("class","tree");this.not("."+n).each(function(){var r="class",i=e.res(r,"treeroot"),s=t.openRootOnLoad,o=e.res(r,"navsubtree"),u=e.res(r,"treedir"),a=e.res(r,"navcollapse"),f=e.res(r,"navexpand"),l="elfinder-subtree-loaded",c=e.res(r,"navarrow"),h=e.res(r,"active"),p=e.res(r,"adroppable"),d=e.res(r,"hover"),v=e.res(r,"disabled"),m=e.res(r,"draggable"),g=e.res(r,"droppable"),y=function(e){var t=H.offset().left;return t<=e&&e<=t+H.width()},b=e.droppable.drop,w=$.extend(true,{},e.droppable,{over:function(e){var t=$(this),n=d+" "+p;if(y(e.clientX)){t.addClass(n);if(t.is("."+a+":not(."+f+")")){setTimeout(function(){t.is("."+p)&&t.children("."+c).click()},500)}}else{t.removeClass(n)}},out:function(){$(this).removeClass(d+" "+p)},drop:function(e,t){y(e.clientX)&&b.call(this,e,t)}}),E=$(e.res("tpl","navspinner")),S=e.res("tpl","navdir"),x=e.res("tpl","perms"),T=e.res("tpl","symlink"),N={id:function(t){return e.navHash2Id(t.hash)},cssclass:function(t){return(t.phash?"":i)+" "+u+" "+e.perms2class(t)+" "+(t.dirs&&!t.link?a:"")},permissions:function(e){return!e.read||!e.write?x:""},symlink:function(e){return e.alias?T:""}},C=function(t){t.name=e.escape(t.i18||t.name);return S.replace(/(?:\{([a-z]+)\})/ig,function(e,n){return t[n]||(N[n]?N[n](t):"")})},k=function(e){return $.map(e||[],function(e){return e.mime=="directory"?e:null})},L=function(t){return t?P.find("#"+e.navHash2Id(t)).next("."+o):P},A=function(t,n){var r=t.children(":first"),i;while(r.length){i=e.file(e.navId2Hash(r.children("[id]").attr("id")));if((i=e.file(e.navId2Hash(r.children("[id]").attr("id"))))&&n.name.toLowerCase().localeCompare(i.name.toLowerCase())<0){return r}r=r.next()}return $("")},O=function(t){var n=t.length,r=[],i=t.length,s,o,u,a;var f=true;while(i--){s=t[i];if(P.find("#"+e.navHash2Id(s.hash)).length){continue}if((u=L(s.phash)).length){o=C(s);if(s.phash&&(a=A(u,s)).length){a.before(o)}else{u[f||s.phash?"append":"prepend"](o);f=false}}else{r.push(s)}}if(r.length&&r.length<n){return O(r)}setTimeout(function(){_()},10)},M=function(n){var r=e.cwd().hash,a=P.find("#"+e.navHash2Id(r)),c,p;if(s){c=P.find("#"+e.navHash2Id(e.root()));c.is("."+l)&&c.addClass(f).next("."+o).show();s=false}if(!a.is("."+h)){P.find("."+u+"."+h).removeClass(h);a.addClass(h)}if(t.syncTree){if(a.length){return a.parentsUntil("."+i).filter("."+o).show().prev("."+u).addClass(f)}if(e.newAPI){p=e.file(r);if(p&&p.phash&&P.find("#"+e.navHash2Id(p.phash)).length){O([p]);return M()}e.request({data:{cmd:"parents",target:r},preventFail:true}).done(function(t){var n=k(t.tree);O(n);D(n,l);r==e.cwd().hash&&M(true)})}}},_=function(){P.find("."+u+":not(."+g+",.elfinder-ro,.elfinder-na)").droppable(w)},D=function(t,n){var r=n==l?"."+a+":not(."+l+")":":not(."+a+")";$.each(t,function(t,i){P.find("#"+e.navHash2Id(i.phash)+r).filter(function(){return $(this).next("."+o).children().length>0}).addClass(n)})},P=$(this).addClass(n).delegate("."+u,"hover",function(t){var n=$(this),r=t.type=="mouseenter";if(!n.is("."+p+" ,."+v)){r&&!n.is("."+i+",."+m+",.elfinder-na,.elfinder-wo")&&n.draggable(e.draggable);n.toggleClass(d,r)}}).delegate("."+u,"dropover dropout drop",function(e){$(this)[e.type=="dropover"?"addClass":"removeClass"](p+" "+d)}).delegate("."+u,"click",function(t){var n=$(this),r=e.navId2Hash(n.attr("id")),i=e.file(r);e.trigger("searchend");if(r!=e.cwd().hash&&!n.is("."+v)){e.exec("open",i.thash||r)}else if(n.is("."+a)){n.children("."+c).click()}}).delegate("."+u+"."+a+" ."+c,"click",function(t){var n=$(this),r=n.parent("."+u),i=r.next("."+o);t.stopPropagation();if(r.is("."+l)){r.toggleClass(f);i.slideToggle()}else{E.insertBefore(n);r.removeClass(a);e.request({cmd:"tree",target:e.navId2Hash(r.attr("id"))}).done(function(e){O(k(e.tree));if(i.children().length){r.addClass(a+" "+f);i.slideDown()}M()}).always(function(e){E.remove();r.addClass(l)})}}).delegate("."+u,"contextmenu",function(t){t.preventDefault();e.trigger("contextmenu",{type:"navbar",targets:[e.navId2Hash($(this).attr("id"))],x:t.clientX,y:t.clientY})}),H=e.getUI("navbar").append(P).show();e.open(function(e){var t=e.data,n=k(t.files);t.init&&P.empty();if(n.length){O(n);D(n,l)}M()}).add(function(e){var t=k(e.data.added);if(t.length){O(t);D(t,a)}}).change(function(t){var n=k(t.data.changed),r=n.length,i,s,a,c,h,p,d,v,m;while(r--){i=n[r];if((s=P.find("#"+e.navHash2Id(i.hash))).length){if(i.phash){c=s.closest("."+o);h=L(i.phash);p=s.parent().next();d=A(h,i);if(!h.length){continue}if(h[0]!==c[0]||p.get(0)!==d.get(0)){d.length?d.before(s):h.append(s)}}v=s.is("."+f);m=s.is("."+l);a=$(C(i));s.replaceWith(a.children("."+u));if(i.dirs&&(v||m)&&(s=P.find("#"+e.navHash2Id(i.hash)))&&s.next("."+o).children().length){v&&s.addClass(f);m&&s.addClass(l)}}}M();_()}).remove(function(t){var n=t.data.removed,r=n.length,i,s;while(r--){if((i=P.find("#"+e.navHash2Id(n[r]))).length){s=i.closest("."+o);i.parent().detach();if(!s.children().length){s.hide().prev("."+u).removeClass(a+" "+f+" "+l)}}}}).bind("search searchend",function(t){P.find("#"+e.navHash2Id(e.cwd().hash))[t.type=="search"?"removeClass":"addClass"](h)}).bind("lockfiles unlockfiles",function(t){var n=t.type=="lockfiles",r=n?"disable":"enable",i=$.map(t.data.files||[],function(t){var n=e.file(t);return n&&n.mime=="directory"?t:null});$.each(i,function(t,i){var s=P.find("#"+e.navHash2Id(i));if(s.length){s.is("."+m)&&s.draggable(r);s.is("."+g)&&s.droppable(h);s[n?"addClass":"removeClass"](v)}})})});return this};$.fn.elfinderuploadbutton=function(e){return this.each(function(){var t=$(this).elfinderbutton(e).unbind("click"),n=$("<form/>").appendTo(t),r=$('<input type="file" multiple="true"/>').change(function(){var t=$(this);if(t.val()){e.exec({input:t.remove()[0]});r.clone(true).appendTo(n)}});n.append(r.clone(true));e.change(function(){n[e.disabled()?"hide":"show"]()}).change()})};$.fn.elfinderviewbutton=function(e){return this.each(function(){var t=$(this).elfinderbutton(e),n=t.children(".elfinder-button-icon");e.change(function(){var r=e.value=="icons";n.toggleClass("elfinder-button-icon-view-list",r);t.attr("title",e.fm.i18n(r?"viewlist":"viewicons"))})})};$.fn.elfinderworkzone=function(e){var t="elfinder-workzone";this.not("."+t).each(function(){var e=$(this).addClass(t),n=e.outerHeight(true)-e.height(),r=e.parent();r.add(window).bind("resize",function(){var i=r.height();r.children(":visible:not(."+t+")").each(function(){var e=$(this);if(e.css("position")!="absolute"){i-=e.outerHeight(true)}});e.height(i-n)})});return this};elFinder.prototype.commands.archive=function(){var e=this,t=e.fm,n=[];this.variants=[];this.disableOnSearch=true;t.bind("open reload",function(){e.variants=[];$.each(n=t.option("archivers")["create"]||[],function(n,r){e.variants.push([r,t.mime2kind(r)])});e.change()});this.getstate=function(){return!this._disabled&&n.length&&t.selected().length&&t.cwd().write?0:-1};this.exec=function(e,r){var i=this.files(e),s=i.length,o=r||n[0],u=t.cwd(),a=["errArchive","errPerm","errCreatingTempDir","errFtpDownloadFile","errFtpUploadFile","errFtpMkdir","errArchiveExec","errExtractExec","errRm"],f=$.Deferred().fail(function(e){e&&t.error(e)}),l;if(!(this.enabled()&&s&&n.length&&$.inArray(o,n)!==-1)){return f.reject()}if(!u.write){return f.reject(a)}for(l=0;l<s;l++){if(!i[l].read){return f.reject(a)}}return t.request({data:{cmd:"archive",targets:this.hashes(e),type:o},notify:{type:"archive",cnt:1},syncOnFail:true})}};elFinder.prototype.commands.back=function(){this.alwaysEnabled=true;this.updateOnSelect=false;this.shortcuts=[{pattern:"ctrl+left backspace"}];this.getstate=function(){return this.fm.history.canBack()?0:-1};this.exec=function(){return this.fm.history.back()}};elFinder.prototype.commands.copy=function(){this.shortcuts=[{pattern:"ctrl+c ctrl+insert"}];this.getstate=function(e){var e=this.files(e),t=e.length;return t&&$.map(e,function(e){return e.phash&&e.read?e:null}).length==t?0:-1};this.exec=function(e){var t=this.fm,n=$.Deferred().fail(function(e){t.error(e)});$.each(this.files(e),function(e,t){if(!(t.read&&t.phash)){return!n.reject(["errCopy",t.name,"errPerm"])}});return n.state()=="rejected"?n:n.resolve(t.clipboard(this.hashes(e)))}};elFinder.prototype.commands.cut=function(){this.shortcuts=[{pattern:"ctrl+x shift+insert"}];this.getstate=function(e){var e=this.files(e),t=e.length;return t&&$.map(e,function(e){return e.phash&&e.read&&!e.locked?e:null}).length==t?0:-1};this.exec=function(e){var t=this.fm,n=$.Deferred().fail(function(e){t.error(e)});$.each(this.files(e),function(e,t){if(!(t.read&&t.phash)){return!n.reject(["errCopy",t.name,"errPerm"])}if(t.locked){return!n.reject(["errLocked",t.name])}});return n.state()=="rejected"?n:n.resolve(t.clipboard(this.hashes(e),true))}};elFinder.prototype.commands.download=function(){var e=this,t=this.fm,n=function(t){return $.map(e.files(t),function(e){return e.mime=="directory"?null:e})};this.shortcuts=[{pattern:"shift+enter"}];this.getstate=function(){var e=this.fm.selected(),r=e.length;return!this._disabled&&r&&(!t.UA.IE||r==1)&&r==n(e).length?0:-1};this.exec=function(e){var t=this.fm,r=t.options.url,i=n(e),s=$.Deferred(),o="",u="",a,f;if(this.disabled()){return s.reject()}u=$.param(t.options.customData||{});if(u){u="&"+u}r+=r.indexOf("?")===-1?"?":"&";for(a=0;a<i.length;a++){o+='<iframe class="downloader" id="downloader-'+i[a].hash+'" style="display:none" src="'+r+"cmd=file&target="+i[a].hash+"&current="+i[a].phash+"&download=1"+u+'"/>'}$(o).appendTo("body").ready(function(){setTimeout(function(){$(o).each(function(){$("#"+$(this).attr("id")).remove()})},t.UA.Firefox?2e4+1e4*a:1e3)});t.trigger("download",{files:i});return s.resolve(e)}};elFinder.prototype.commands.duplicate=function(){var e=this.fm;this.getstate=function(t){var t=this.files(t),n=t.length;return!this._disabled&&n&&e.cwd().write&&$.map(t,function(e){return e.phash&&e.read?e:null}).length==n?0:-1};this.exec=function(e){var t=this.fm,n=this.files(e),r=n.length,i=$.Deferred().fail(function(e){e&&t.error(e)}),s=[];if(!r||this._disabled){return i.reject()}$.each(n,function(e,n){if(!n.read||!t.file(n.phash).write){return!i.reject(["errCopy",n.name,"errPerm"])}});if(i.state()=="rejected"){return i}return t.request({data:{cmd:"duplicate",targets:this.hashes(e)},notify:{type:"copy",cnt:r}})}};elFinder.prototype.commands.edit=function(){var e=this,t=this.fm,n=t.res("mimes","text")||[],r=function(t){return $.map(t,function(t){return(t.mime.indexOf("text/")===0||$.inArray(t.mime,n)!==-1)&&t.mime.indexOf("text/rtf")&&(!e.onlyMimes.length||$.inArray(t.mime,e.onlyMimes)!==-1)&&t.read&&t.write?t:null})},i=function(n,r,i){var s=$.Deferred(),o=$('<textarea class="elfinder-file-edit" rows="20" id="'+n+'-ta">'+t.escape(i)+"</textarea>"),u=function(){o.editor&&o.editor.save(o[0],o.editor.instance);s.resolve(o.getContent());o.elfinderdialog("close")},a=function(){s.reject();o.elfinderdialog("close")},f={title:r.name,width:e.options.dialogWidth||800,buttons:{},close:function(){o.editor&&o.editor.close(o[0],o.editor.instance);$(this).elfinderdialog("destroy")},open:function(){t.disable();o.focus();o[0].setSelectionRange&&o[0].setSelectionRange(0,0);o.editor&&o.editor.load(o[0])}};o.getContent=function(){return o.val()};$.each(e.options.editors||[],function(e,t){if($.inArray(r.mime,t.mimes||[])!==-1&&typeof t.load=="function"&&typeof t.save=="function"){o.editor={load:t.load,save:t.save,close:typeof t.close=="function"?t.close:function(){},instance:null};return false}});if(!o.editor){o.keydown(function(e){var t=e.keyCode,n,r;e.stopPropagation();if(t==9){e.preventDefault();if(this.setSelectionRange){n=this.value;r=this.selectionStart;this.value=n.substr(0,r)+"   "+n.substr(this.selectionEnd);r+=1;this.setSelectionRange(r,r)}}if(e.ctrlKey||e.metaKey){if(t==81||t==87){e.preventDefault();a()}if(t==83){e.preventDefault();u()}}})}f.buttons[t.i18n("Save")]=u;f.buttons[t.i18n("Cancel")]=a;t.dialog(o,f).attr("id",n);return s.promise()},s=function(e){var n=e.hash,r=t.options,s=$.Deferred(),o={cmd:"file",target:n},u=t.url(n)||t.options.url,a="edit-"+t.namespace+"-"+e.hash,f=t.getUI().find("#"+a),l;if(f.length){f.elfinderdialog("toTop");return s.resolve()}if(!e.read||!e.write){l=["errOpen",e.name,"errPerm"];t.error(l);return s.reject(l)}t.request({data:{cmd:"get",target:n},notify:{type:"openfile",cnt:1},syncOnFail:true}).done(function(r){i(a,e,r.content).done(function(e){t.request({options:{type:"post"},data:{cmd:"put",target:n,content:e},notify:{type:"save",cnt:1},syncOnFail:true}).fail(function(e){s.reject(e)}).done(function(e){e.changed&&e.changed.length&&t.change(e);s.resolve(e)})})}).fail(function(e){s.reject(e)});return s.promise()};this.shortcuts=[{pattern:"ctrl+e"}];this.init=function(){this.onlyMimes=this.options.mimes||[]};this.getstate=function(e){var e=this.files(e),t=e.length;return!this._disabled&&t&&r(e).length==t?0:-1};this.exec=function(e){var t=r(this.files(e)),n=[],i;if(this.disabled()){return $.Deferred().reject()}while(i=t.shift()){n.push(s(i))}return n.length?$.when.apply(null,n):$.Deferred().reject()}};elFinder.prototype.commands.extract=function(){var e=this,t=e.fm,n=[],r=function(e){return $.map(e,function(e){return e.read&&$.inArray(e.mime,n)!==-1?e:null})};this.disableOnSearch=true;t.bind("open reload",function(){n=t.option("archivers")["extract"]||[];e.change()});this.getstate=function(e){var e=this.files(e),t=e.length;return!this._disabled&&t&&this.fm.cwd().write&&r(e).length==t?0:-1};this.exec=function(e){var r=this.files(e),i=$.Deferred(),s=r.length,o,u,a;var f=false;var l=false;var c=$.map(t.files(e),function(e){return e.name});var h={};$.map(t.files(e),function(e){h[e.name]=e});var p=function(e){switch(e){case"overwrite_all":f=true;break;case"omit_all":l=true;break}};var d=function(e){if(!(e.read&&t.file(e.phash).write)){u=["errExtract",e.name,"errPerm"];t.error(u);i.reject(u)}else if($.inArray(e.mime,n)===-1){u=["errExtract",e.name,"errNoArchive"];t.error(u);i.reject(u)}else{t.request({data:{cmd:"extract",target:e.hash},notify:{type:"extract",cnt:1},syncOnFail:true}).fail(function(e){if(i.state()!="rejected"){i.reject(e)}}).done(function(){})}};var v=function(e,n){var r=e[n];var u=r.name.replace(/\.((tar\.(gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(gz|bz2)|[a-z0-9]{1,4})$/ig,"");var m=$.inArray(u,c)>=0;if(m&&h[u].mime!="directory"){t.confirm({title:t.i18n("ntfextract"),text:t.i18n(["errExists",u,"confirmRepl"]),accept:{label:"btnYes",callback:function(t){a=t?"overwrite_all":"overwrite";p(a);if(!f&&!l){if("overwrite"==a){d(r)}if(n+1<s){v(e,n+1)}else{i.resolve()}}else if(f){for(o=0;o<s;o++){d(e[o])}i.resolve()}}},reject:{label:"btnNo",callback:function(t){a=t?"omit_all":"omit";p(a);if(!f&&!l&&n+1<s){v(e,n+1)}else if(l){i.resolve()}}},cancel:{label:"btnCancel",callback:function(){i.resolve()}},all:s>1})}else{d(r);if(n+1<s){v(e,n+1)}else{i.resolve()}}};if(!(this.enabled()&&s&&n.length)){return i.reject()}if(s>0){v(r,0)}return i}};elFinder.prototype.commands.forward=function(){this.alwaysEnabled=true;this.updateOnSelect=true;this.shortcuts=[{pattern:"ctrl+right"}];this.getstate=function(){return this.fm.history.canForward()?0:-1};this.exec=function(){return this.fm.history.forward()}};elFinder.prototype.commands.getfile=function(){var e=this,t=this.fm,n=function(t){var n=e.options;t=$.map(t,function(e){return e.mime!="directory"||n.folders?e:null});return n.multiple||t.length==1?t:[]};this.alwaysEnabled=true;this.callback=t.options.getFileCallback;this._disabled=typeof this.callback=="function";this.getstate=function(e){var e=this.files(e),t=e.length;return this.callback&&t&&n(e).length==t?0:-1};this.exec=function(t){var n=this.fm,r=this.options,i=this.files(t),s=i.length,o=n.option("url"),u=n.option("tmbUrl"),a=$.Deferred().done(function(t){n.trigger("getfile",{files:t});e.callback(t,n);if(r.oncomplete=="close"){n.hide()}else if(r.oncomplete=="destroy"){n.destroy()}}),f=function(e){return r.onlyURL?r.multiple?$.map(i,function(e){return e.url}):i[0].url:r.multiple?i:i[0]},l=[],c,h,p;if(this.getstate()==-1){return a.reject()}for(c=0;c<s;c++){h=i[c];if(h.mime=="directory"&&!r.folders){return a.reject()}h.baseUrl=o;h.url=n.url(h.hash);h.path=n.path(h.hash);if(h.tmb&&h.tmb!=1){h.tmb=u+h.tmb}if(!h.width&&!h.height){if(h.dim){p=h.dim.split("x");h.width=p[0];h.height=p[1]}else if(h.mime.indexOf("image")!==-1){l.push(n.request({data:{cmd:"dim",target:h.hash},notify:{type:"dim",cnt:1,hideCnt:true},preventDefault:true}).done(function(e){if(e.dim){var t=e.dim.split("x");var r=n.file(this.hash);r.width=this.width=t[0];r.height=this.height=t[1]}}.bind(h)))}}}if(l.length){$.when.apply(null,l).always(function(){a.resolve(f(i))});return a}return a.resolve(f(i))}};elFinder.prototype.commands.help=function(){var e=this.fm,t=this,n='<div class="elfinder-help-link"> <a href="{url}">{link}</a></div>',r='<div class="elfinder-help-link"> <a href="{url}" target="_blank">{link}</a></div>',i='<div class="elfinder-help-team"><div>{author}</div>{work}</div>',s=/\{url\}/,o=/\{link\}/,u=/\{author\}/,a=/\{work\}/,f="replace",l="ui-priority-primary",c="ui-priority-secondary",h="elfinder-help-license",p='<li class="ui-state-default ui-corner-top"><a href="#{id}">{title}</a></li>',d=['<div class="ui-tabs ui-widget ui-widget-content ui-corner-all elfinder-help">','<ul class="ui-tabs-nav ui-helper-reset ui-helper-clearfix ui-widget-header ui-corner-all">'],v='<div class="elfinder-help-shortcut"><div class="elfinder-help-shortcut-pattern">{pattern}</div> {descrip}</div>',m='<div class="elfinder-help-separator"/>',g=function(){d.push('<div id="about" class="ui-tabs-panel ui-widget-content ui-corner-bottom"><div class="elfinder-help-logo"/>');d.push("<h3>elFinder</h3>");d.push('<div class="'+l+'">'+e.i18n("webfm")+"</div>");d.push('<div class="'+c+'">'+e.i18n("ver")+": "+e.version+", "+e.i18n("protocolver")+': <span id="apiver"></span></div>');d.push('<div class="'+c+'">jQuery/jQuery UI: '+$().jquery+"/"+$.ui.version+"</div>");d.push(m);d.push(r[f](s,"http://elfinder.org/")[f](o,e.i18n("homepage")));d.push(r[f](s,"https://github.com/Studio-42/elFinder/wiki")[f](o,e.i18n("docs")));d.push(r[f](s,"https://github.com/Studio-42/elFinder")[f](o,e.i18n("github")));d.push(r[f](s,"http://twitter.com/elrte_elfinder")[f](o,e.i18n("twitter")));d.push(m);d.push('<div class="'+l+'">'+e.i18n("team")+"</div>");d.push(i[f](u,'Dmitry "dio" Levashov &lt;dio@std42.ru&gt;')[f](a,e.i18n("chiefdev")));d.push(i[f](u,"Troex Nevelin &lt;troex@fury.scancode.ru&gt;")[f](a,e.i18n("maintainer")));d.push(i[f](u,"Alexey Sukhotin &lt;strogg@yandex.ru&gt;")[f](a,e.i18n("contributor")));d.push(i[f](u,"Naoki Sawada &lt;hypweb@gmail.com&gt;")[f](a,e.i18n("contributor")));e.i18[e.lang].translator&&d.push(i[f](u,e.i18[e.lang].translator)[f](a,e.i18n("translator")+" ("+e.i18[e.lang].language+")"));d.push(m);d.push('<div class="'+h+'">'+e.i18n("icons")+': Pixelmixer, <a href="http://p.yusukekamiyamane.com" target="_blank">Fugue</a></div>');d.push(m);d.push('<div class="'+h+'">Licence: BSD Licence</div>');d.push('<div class="'+h+'">Copyright © 2009-2011, Studio 42</div>');d.push('<div class="'+h+'">„ …'+e.i18n("dontforget")+" ”</div>");d.push("</div>")},y=function(){var t=e.shortcuts();d.push('<div id="shortcuts" class="ui-tabs-panel ui-widget-content ui-corner-bottom">');if(t.length){d.push('<div class="ui-widget-content elfinder-help-shortcuts">');$.each(t,function(e,t){d.push(v.replace(/\{pattern\}/,t[0]).replace(/\{descrip\}/,t[1]))});d.push("</div>")}else{d.push('<div class="elfinder-help-disabled">'+e.i18n("shortcutsof")+"</div>")}d.push("</div>")},b=function(){d.push('<div id="help" class="ui-tabs-panel ui-widget-content ui-corner-bottom">');d.push('<a href="http://elfinder.org/forum/" target="_blank" class="elfinder-dont-panic"><span>DON\'T PANIC</span></a>');d.push("</div>")},w;this.alwaysEnabled=true;this.updateOnSelect=false;this.state=0;this.shortcuts=[{pattern:"f1",description:this.title}];setTimeout(function(){var n=t.options.view||["about","shortcuts","help"];$.each(n,function(t,n){d.push(p[f](/\{id\}/,n)[f](/\{title\}/,e.i18n(n)))});d.push("</ul>");$.inArray("about",n)!==-1&&g();$.inArray("shortcuts",n)!==-1&&y();$.inArray("help",n)!==-1&&b();d.push("</div>");w=$(d.join(""));e.one("load",function(){w.find("#apiver").text(e.api)});w.find(".ui-tabs-nav li").hover(function(){$(this).toggleClass("ui-state-hover")}).children().click(function(e){var t=$(this);e.preventDefault();e.stopPropagation();if(!t.is(".ui-tabs-selected")){t.parent().addClass("ui-tabs-selected ui-state-active").siblings().removeClass("ui-tabs-selected").removeClass("ui-state-active");w.find(".ui-tabs-panel").hide().filter(t.attr("href")).show()}}).filter(":first").click()},200);this.getstate=function(){return 0};this.exec=function(){if(!this.dialog){this.dialog=this.fm.dialog(w,{title:this.title,width:530,autoOpen:false,destroyOnClose:false})}this.dialog.elfinderdialog("open").find(".ui-tabs-nav li a:first").click()}};elFinder.prototype.commands.home=function(){this.title="Home";this.alwaysEnabled=true;this.updateOnSelect=false;this.shortcuts=[{pattern:"ctrl+home ctrl+shift+up",description:"Home"}];this.getstate=function(){var e=this.fm.root(),t=this.fm.cwd().hash;return e&&t&&e!=t?0:-1};this.exec=function(){return this.fm.exec("open",this.fm.root())}};elFinder.prototype.commands.info=function(){var e="msg",t=this.fm,n="elfinder-info-spinner",r={calc:t.i18n("calc"),size:t.i18n("size"),unknown:t.i18n("unknown"),path:t.i18n("path"),aliasfor:t.i18n("aliasfor"),modify:t.i18n("modify"),perms:t.i18n("perms"),locked:t.i18n("locked"),dim:t.i18n("dim"),kind:t.i18n("kind"),files:t.i18n("files"),folders:t.i18n("folders"),items:t.i18n("items"),yes:t.i18n("yes"),no:t.i18n("no"),link:t.i18n("link")};this.tpl={main:'<div class="ui-helper-clearfix elfinder-info-title"><span class="elfinder-cwd-icon {class} ui-corner-all"/>{title}</div><table class="elfinder-info-tb">{content}</table>',itemTitle:'<strong>{name}</strong><span class="elfinder-info-kind">{kind}</span>',groupTitle:"<strong>{items}: {num}</strong>",row:"<tr><td>{label} : </td><td>{value}</td></tr>",spinner:'<span>{text}</span> <span class="'+n+'"/>'};this.alwaysEnabled=true;this.updateOnSelect=false;this.shortcuts=[{pattern:"ctrl+i"}];this.init=function(){$.each(r,function(e,n){r[e]=t.i18n(n)})};this.getstate=function(){return 0};this.exec=function(e){var t=this.files(e);if(!t.length){t=this.files([this.fm.cwd().hash])}var i=this,s=this.fm,o=this.tpl,u=o.row,a=t.length,f=[],l=o.main,c="{label}",h="{value}",p={title:this.title,width:"auto",close:function(){$(this).elfinderdialog("destroy")}},d=[],v=function(e){g.find("."+n).parent().text(e)},m=s.namespace+"-info-"+$.map(t,function(e){return e.hash}).join("-"),g=s.getUI().find("#"+m),y,b,w,E,S;if(!a){return $.Deferred().reject()}if(g.length){g.elfinderdialog("toTop");return $.Deferred().resolve()}if(a==1){w=t[0];l=l.replace("{class}",s.mime2class(w.mime));E=o.itemTitle.replace("{name}",s.escape(w.i18||w.name)).replace("{kind}",s.mime2kind(w));if(w.tmb){b=s.option("tmbUrl")+w.tmb}if(!w.read){y=r.unknown}else if(w.mime!="directory"||w.alias){y=s.formatSize(w.size)}else{y=o.spinner.replace("{text}",r.calc);d.push(w.hash)}f.push(u.replace(c,r.size).replace(h,y));w.alias&&f.push(u.replace(c,r.aliasfor).replace(h,w.alias));f.push(u.replace(c,r.path).replace(h,s.escape(s.path(w.hash,true))));w.read&&f.push(u.replace(c,r.link).replace(h,'<a href="'+s.url(w.hash)+'" target="_blank">'+w.name+"</a>"));if(w.dim){f.push(u.replace(c,r.dim).replace(h,w.dim))}else if(w.mime.indexOf("image")!==-1){if(w.width&&w.height){f.push(u.replace(c,r.dim).replace(h,w.width+"x"+w.height))}else{f.push(u.replace(c,r.dim).replace(h,o.spinner.replace("{text}",r.calc)));s.request({data:{cmd:"dim",target:w.hash},preventDefault:true}).fail(function(){v(r.unknown)}).done(function(e){v(e.dim||r.unknown);if(e.dim){var t=e.dim.split("x");var n=s.file(w.hash);n.width=t[0];n.height=t[1]}})}}f.push(u.replace(c,r.modify).replace(h,s.formatDate(w)));f.push(u.replace(c,r.perms).replace(h,s.formatPermissions(w)));f.push(u.replace(c,r.locked).replace(h,w.locked?r.yes:r.no))}else{l=l.replace("{class}","elfinder-cwd-icon-group");E=o.groupTitle.replace("{items}",r.items).replace("{num}",a);S=$.map(t,function(e){return e.mime=="directory"?1:null}).length;if(!S){y=0;$.each(t,function(e,t){var n=parseInt(t.size);if(n>=0&&y>=0){y+=n}else{y="unknown"}});f.push(u.replace(c,r.kind).replace(h,r.files));f.push(u.replace(c,r.size).replace(h,s.formatSize(y)))}else{f.push(u.replace(c,r.kind).replace(h,S==a?r.folders:r.folders+" "+S+", "+r.files+" "+(a-S)));f.push(u.replace(c,r.size).replace(h,o.spinner.replace("{text}",r.calc)));d=$.map(t,function(e){return e.hash})}}l=l.replace("{title}",E).replace("{content}",f.join(""));g=s.dialog(l,p);g.attr("id",m);if(b){$("<img/>").load(function(){g.find(".elfinder-cwd-icon").css("background",'url("'+b+'") center center no-repeat')}).attr("src",b)}if(d.length){s.request({data:{cmd:"size",targets:d},preventDefault:true}).fail(function(){v(r.unknown)}).done(function(e){var t=parseInt(e.size);v(t>=0?s.formatSize(t):r.unknown)})}}};elFinder.prototype.commands.mkdir=function(){this.disableOnSearch=true;this.updateOnSelect=false;this.mime="directory";this.prefix="untitled folder";this.exec=$.proxy(this.fm.res("mixin","make"),this);this.shortcuts=[{pattern:"ctrl+shift+n"}];this.getstate=function(){return!this._disabled&&this.fm.cwd().write?0:-1}};elFinder.prototype.commands.mkfile=function(){this.disableOnSearch=true;this.updateOnSelect=false;this.mime="text/plain";this.prefix="untitled file.txt";this.exec=$.proxy(this.fm.res("mixin","make"),this);this.getstate=function(){return!this._disabled&&this.fm.cwd().write?0:-1}};elFinder.prototype.commands.netmount=function(){var e=this;this.alwaysEnabled=true;this.updateOnSelect=false;this.drivers=[];this.handlers={load:function(){this.drivers=this.fm.netDrivers}};this.getstate=function(){return this.drivers.length?0:-1};this.exec=function(){var t=e.fm,n=$.Deferred(),r=function(){var r={protocol:$("<select/>"),host:$('<input type="text"/>'),port:$('<input type="text"/>'),path:$('<input type="text" value="/"/>'),user:$('<input type="text"/>'),pass:$('<input type="password"/>')},i={title:t.i18n("netMountDialogTitle"),resizable:false,modal:true,destroyOnClose:true,close:function(){delete e.dialog;n.state()=="pending"&&n.reject()},buttons:{}},s=$('<table class="elfinder-info-tb elfinder-netmount-tb"/>');$.each(e.drivers,function(e,n){r.protocol.append('<option value="'+n+'">'+t.i18n(n)+"</option>")});$.each(r,function(e,n){e!="protocol"&&n.addClass("ui-corner-all");s.append($("<tr/>").append($("<td>"+t.i18n(e)+"</td>")).append($("<td/>").append(n)))});i.buttons[t.i18n("btnMount")]=function(){var t={cmd:"netmount"};$.each(r,function(e,n){var r=$.trim(n.val());if(r){t[e]=r}});if(!t.host){return e.fm.trigger("error",{error:"errNetMountHostReq"})}e.fm.request({data:t,notify:{type:"netmount",cnt:1}}).done(function(){n.resolve()}).fail(function(e){n.reject(e)});e.dialog.elfinderdialog("close")};i.buttons[t.i18n("btnCancel")]=function(){e.dialog.elfinderdialog("close")};return t.dialog(s,i)};if(!e.dialog){e.dialog=r()}return n.promise()}};elFinder.prototype.commands.open=function(){this.alwaysEnabled=true;this._handlers={dblclick:function(e){e.preventDefault();this.exec()},"select enable disable reload":function(e){this.update(e.type=="disable"?-1:void 0)}};this.shortcuts=[{pattern:"ctrl+down numpad_enter"+(this.fm.OS!="mac"&&" enter")}];this.getstate=function(e){var e=this.files(e),t=e.length;return t==1?0:t?$.map(e,function(e){return e.mime=="directory"?null:e}).length==t?0:-1:-1};this.exec=function(e){var t=this.fm,n=$.Deferred().fail(function(e){e&&t.error(e)}),r=this.files(e),i=r.length,s,o,u,a;if(!i){return n.reject()}if(i==1&&(s=r[0])&&s.mime=="directory"){return s&&!s.read?n.reject(["errOpen",s.name,"errPerm"]):t.request({data:{cmd:"open",target:s.thash||s.hash},notify:{type:"open",cnt:1,hideCnt:true},syncOnFail:true})}r=$.map(r,function(e){return e.mime!="directory"?e:null});if(i!=r.length){return n.reject()}i=r.length;while(i--){s=r[i];if(!s.read){return n.reject(["errOpen",s.name,"errPerm"])}if(!(o=t.url(s.hash))){o=t.options.url;o=o+(o.indexOf("?")===-1?"?":"&")+(t.oldAPI?"cmd=open&current="+s.phash:"cmd=file")+"&target="+s.hash}if(s.dim){u=s.dim.split("x");a="width="+(parseInt(u[0])+20)+",height="+(parseInt(u[1])+20)}else{a="width="+parseInt(2*$(window).width()/3)+",height="+parseInt(2*$(window).height()/3)}if(!window.open(o,"_blank",a+",top=50,left=50,scrollbars=yes,resizable=yes")){return n.reject("errPopup")}}return n.resolve(e)}};elFinder.prototype.commands.paste=function(){this.updateOnSelect=false;this.handlers={changeclipboard:function(){this.update()}};this.shortcuts=[{pattern:"ctrl+v shift+insert"}];this.getstate=function(e){if(this._disabled){return-1}if(e){if($.isArray(e)){if(e.length!=1){return-1}e=this.fm.file(e[0])}}else{e=this.fm.cwd()}return this.fm.clipboard().length&&e.mime=="directory"&&e.write?0:-1};this.exec=function(e){var t=this,n=t.fm,e=e?this.files(e)[0]:n.cwd(),r=n.clipboard(),i=r.length,s=i?r[0].cut:false,o=s?"errMove":"errCopy",u=[],a=[],f=$.Deferred().fail(function(e){e&&n.error(e)}),l=function(e){return e.length&&n._commands.duplicate?n.exec("duplicate",e):$.Deferred().resolve()},c=function(r){var i=$.Deferred(),o=[],u=function(e,t){var n=[],r=e.length;while(r--){$.inArray(e[r].name,t)!==-1&&n.unshift(r)}return n},a=function(e){var t=o[e],u=r[t],f=e==o.length-1;if(!u){return}n.confirm({title:n.i18n(s?"moveFiles":"copyFiles"),text:n.i18n(["errExists",u.name,"confirmRepl"]),all:!f,accept:{label:"btnYes",callback:function(t){!f&&!t?a(++e):l(r)}},reject:{label:"btnNo",callback:function(t){var n;if(t){n=o.length;while(e<n--){r[o[n]].remove=true}}else{r[o[e]].remove=true}!f&&!t?a(++e):l(r)}},cancel:{label:"btnCancel",callback:function(){i.resolve()}}})},f=function(e){o=u(r,e);o.length?a(0):l(r)},l=function(t){var t=$.map(t,function(e){return!e.remove?e:null}),r=t.length,o={},u=[],a;if(!r){return i.resolve()}a=t[0].phash;t=$.map(t,function(e){return e.hash});n.request({data:{cmd:"paste",dst:e.hash,targets:t,cut:s?1:0,src:a},notify:{type:s?"move":"copy",cnt:r}}).always(function(){i.resolve();n.unlockfiles({files:t})})};if(t._disabled||!r.length){return i.resolve()}if(n.oldAPI){l(r)}else{if(!n.option("copyOverwrite")){l(r)}else{e.hash==n.cwd().hash?f($.map(n.files(),function(t){return t.phash==e.hash?t.name:null})):n.request({data:{cmd:"ls",target:e.hash},notify:{type:"prepare",cnt:1,hideCnt:true},preventFail:true}).always(function(e){f(e.list||[])})}}return i},h,p;if(!i||!e||e.mime!="directory"){return f.reject()}if(!e.write){return f.reject([o,r[0].name,"errPerm"])}h=n.parents(e.hash);$.each(r,function(t,i){if(!i.read){return!f.reject([o,r[0].name,"errPerm"])}if(s&&i.locked){return!f.reject(["errLocked",i.name])}if($.inArray(i.hash,h)!==-1){return!f.reject(["errCopyInItself",i.name])}p=n.parents(i.hash);if($.inArray(e.hash,p)!==-1){if($.map(p,function(t){var r=n.file(t);return r.phash==e.hash&&r.name==i.name?r:null}).length){return!f.reject(["errReplByChild",i.name])}}if(i.phash==e.hash){a.push(i.hash)}else{u.push({hash:i.hash,phash:i.phash,name:i.name})}});if(f.state()=="rejected"){return f}return $.when(l(a),c(u)).always(function(){s&&n.clipboard([])})}};elFinder.prototype.commands.quicklook=function(){var e=this,t=e.fm,n=0,r=1,i=2,s=n,o="elfinder-quicklook-navbar-icon",u="elfinder-quicklook-fullscreen",a=function(e){$(document).trigger($.Event("keydown",{keyCode:e,ctrlKey:false,shiftKey:false,altKey:false,metaKey:false}))},f=function(e){return{opacity:0,width:20,height:t.view=="list"?1:20,top:e.offset().top+"px",left:e.offset().left+"px"}},l=function(){var e=$(window);return{opacity:1,width:h,height:p,top:parseInt((e.height()-p)/2+e.scrollTop()),left:parseInt((e.width()-h)/2+e.scrollLeft())}},c=function(e){var t=document.createElement(e.substr(0,e.indexOf("/"))),n=false;try{n=t.canPlayType&&t.canPlayType(e)}catch(r){}return n&&n!==""&&n!="no"},h,p,d,v,m=$('<div class="elfinder-quicklook-title"/>'),g=$("<div/>"),y=$('<div class="elfinder-quicklook-info"/>'),b=$('<div class="'+o+" "+o+'-fullscreen"/>').mousedown(function(n){var r=e.window,i=r.is("."+u),s="scroll."+t.namespace,a=$(window);n.stopPropagation();if(i){r.css(r.data("position")).unbind("mousemove");a.unbind(s).trigger(e.resize).unbind(e.resize);w.unbind("mouseenter").unbind("mousemove")}else{r.data("position",{left:r.css("left"),top:r.css("top"),width:r.width(),height:r.height()}).css({width:"100%",height:"100%"});$(window).bind(s,function(){r.css({left:parseInt($(window).scrollLeft())+"px",top:parseInt($(window).scrollTop())+"px"})}).bind(e.resize,function(t){e.preview.trigger("changesize")}).trigger(s).trigger(e.resize);r.bind("mousemove",function(e){w.stop(true,true).show().delay(3e3).fadeOut("slow")}).mousemove();w.mouseenter(function(){w.stop(true,true).show()}).mousemove(function(e){e.stopPropagation()})}w.attr("style","").draggable(i?"destroy":{});r.toggleClass(u);$(this).toggleClass(o+"-fullscreen-off");$.fn.resizable&&d.add(r).resizable(i?"enable":"disable").removeClass("ui-state-disabled")}),w=$('<div class="elfinder-quicklook-navbar"/>').append($('<div class="'+o+" "+o+'-prev"/>').mousedown(function(){a(37)})).append(b).append($('<div class="'+o+" "+o+'-next"/>').mousedown(function(){a(39)})).append('<div class="elfinder-quicklook-navbar-separator"/>').append($('<div class="'+o+" "+o+'-close"/>').mousedown(function(){e.window.trigger("close")}));this.resize="resize."+t.namespace;this.info=$('<div class="elfinder-quicklook-info-wrapper"/>').append(g).append(y);this.preview=$('<div class="elfinder-quicklook-preview ui-helper-clearfix"/>').bind("change",function(t){e.info.attr("style","").hide();g.removeAttr("class").attr("style","");y.html("")}).bind("update",function(t){var n=e.fm,r=e.preview,i=t.file,s='<div class="elfinder-quicklook-info-data">{value}</div>',o;if(i){!i.read&&t.stopImmediatePropagation();e.window.data("hash",i.hash);e.preview.unbind("changesize").trigger("change").children().remove();m.html(n.escape(i.name));y.html(s.replace(/\{value\}/,i.name)+s.replace(/\{value\}/,n.mime2kind(i))+(i.mime=="directory"?"":s.replace(/\{value\}/,n.formatSize(i.size)))+s.replace(/\{value\}/,n.i18n("modify")+": "+n.formatDate(i)));g.addClass("elfinder-cwd-icon ui-corner-all "+n.mime2class(i.mime));if(i.tmb){$("<img/>").hide().appendTo(e.preview).load(function(){g.css("background",'url("'+o+'") center center no-repeat');$(this).remove()}).attr("src",o=n.tmb(i.hash))}e.info.delay(100).fadeIn(10)}else{t.stopImmediatePropagation()}});this.window=$('<div class="ui-helper-reset ui-widget elfinder-quicklook" style="position:absolute"/>').click(function(e){e.stopPropagation()}).append($('<div class="elfinder-quicklook-titlebar"/>').append(m).append($('<span class="ui-icon ui-icon-circle-close"/>').mousedown(function(t){t.stopPropagation();e.window.trigger("close")}))).append(this.preview.add(w)).append(e.info.hide()).draggable({handle:"div.elfinder-quicklook-titlebar"}).bind("open",function(t){var n=e.window,o=e.value,u;if(e.closed()&&o&&(u=v.find("#"+o.hash)).length){w.attr("style","");s=r;u.trigger("scrolltoview");n.css(f(u)).show().animate(l(),550,function(){s=i;e.update(1,e.value)})}}).bind("close",function(t){var i=e.window,o=e.preview.trigger("change"),a=e.value,l=v.find("#"+i.data("hash")),c=function(){s=n;i.hide();o.children().remove();e.update(0,e.value)};if(e.opened()){s=r;i.is("."+u)&&b.mousedown();l.length?i.animate(f(l),500,c):c()}});this.alwaysEnabled=true;this.value=null;this.handlers={select:function(){this.update(void 0,this.fm.selectedFiles()[0])},error:function(){e.window.is(":visible")&&e.window.data("hash","").trigger("close")},"searchshow searchhide":function(){this.opened()&&this.window.trigger("close")}};this.shortcuts=[{pattern:"space"}];this.support={audio:{ogg:c('audio/ogg; codecs="vorbis"'),mp3:c("audio/mpeg;"),wav:c('audio/wav; codecs="1"'),m4a:c("audio/x-m4a;")||c("audio/aac;")},video:{ogg:c('video/ogg; codecs="theora"'),webm:c('video/webm; codecs="vp8, vorbis"'),mp4:c('video/mp4; codecs="avc1.42E01E"')||c('video/mp4; codecs="avc1.42E01E, mp4a.40.2"')}};this.closed=function(){return s==n};this.opened=function(){return s==i};this.init=function(){var n=this.options,r=this.window,i=this.preview,s,o;h=n.width>0?parseInt(n.width):450;p=n.height>0?parseInt(n.height):300;t.one("load",function(){d=t.getUI();v=t.getUI("cwd");r.appendTo("body").zIndex(100+d.zIndex());$(document).keydown(function(t){t.keyCode==27&&e.opened()&&r.trigger("close")});if($.fn.resizable){r.resizable({handles:"se",minWidth:350,minHeight:120,resize:function(){i.trigger("changesize")}})}e.change(function(){if(e.opened()){e.value?i.trigger($.Event("update",{file:e.value})):r.trigger("close")}});$.each(t.commands.quicklook.plugins||[],function(t,n){if(typeof n=="function"){new n(e)}});i.bind("update",function(){e.info.show()})})};this.getstate=function(){return this.fm.selected().length==1?s==i?1:0:-1};this.exec=function(){this.enabled()&&this.window.trigger(this.opened()?"close":"open")};this.hideinfo=function(){this.info.stop(true).hide()}};elFinder.prototype.commands.quicklook.plugins=[function(e){var t=["image/jpeg","image/png","image/gif"],n=e.preview;$.each(navigator.mimeTypes,function(e,n){var r=n.type;if(r.indexOf("image/")===0&&$.inArray(r,t)){t.push(r)}});n.bind("update",function(r){var i=r.file,s;if($.inArray(i.mime,t)!==-1){r.stopImmediatePropagation();s=$("<img/>").hide().appendTo(n).load(function(){setTimeout(function(){var t=(s.width()/s.height()).toFixed(2);n.bind("changesize",function(){var e=parseInt(n.width()),r=parseInt(n.height()),i,o;if(t<(e/r).toFixed(2)){o=r;i=Math.floor(o*t)}else{i=e;o=Math.floor(i/t)}s.width(i).height(o).css("margin-top",o<r?Math.floor((r-o)/2):0)}).trigger("changesize");e.hideinfo();s.fadeIn(100)},1)}).attr("src",e.fm.url(i.hash))}})},function(e){var t=["text/html","application/xhtml+xml"],n=e.preview,r=e.fm;n.bind("update",function(i){var s=i.file,o;if($.inArray(s.mime,t)!==-1){i.stopImmediatePropagation();n.one("change",function(){o.state()=="pending"&&o.reject()});o=r.request({data:{cmd:"get",target:s.hash,current:s.phash},preventDefault:true}).done(function(t){e.hideinfo();doc=$('<iframe class="elfinder-quicklook-preview-html"/>').appendTo(n)[0].contentWindow.document;doc.open();doc.write(t.content);doc.close()})}})},function(e){var t=e.fm,n=t.res("mimes","text"),r=e.preview;r.bind("update",function(i){var s=i.file,o=s.mime,u;if(o.indexOf("text/")===0||$.inArray(o,n)!==-1){i.stopImmediatePropagation();r.one("change",function(){u.state()=="pending"&&u.reject()});u=t.request({data:{cmd:"get",target:s.hash},preventDefault:true}).done(function(n){e.hideinfo();$('<div class="elfinder-quicklook-preview-text-wrapper"><pre class="elfinder-quicklook-preview-text">'+t.escape(n.content)+"</pre></div>").appendTo(r)})}})},function(e){var t=e.fm,n="application/pdf",r=e.preview,i=false;if(t.UA.Safari&&t.OS=="mac"||t.UA.IE){i=true}else{$.each(navigator.plugins,function(e,t){$.each(t,function(e,t){if(t.type==n){return!(i=true)}})})}i&&r.bind("update",function(i){var s=i.file,o;if(s.mime==n){i.stopImmediatePropagation();r.one("change",function(){o.unbind("load").remove()});o=$('<iframe class="elfinder-quicklook-preview-pdf"/>').hide().appendTo(r).load(function(){e.hideinfo();o.show()}).attr("src",t.url(s.hash))}})},function(e){var t=e.fm,n="application/x-shockwave-flash",r=e.preview,i=false;$.each(navigator.plugins,function(e,t){$.each(t,function(e,t){if(t.type==n){return!(i=true)}})});i&&r.bind("update",function(i){var s=i.file,o;if(s.mime==n){i.stopImmediatePropagation();e.hideinfo();r.append(o=$('<embed class="elfinder-quicklook-preview-flash" pluginspage="http://www.macromedia.com/go/getflashplayer" src="'+t.url(s.hash)+'" quality="high" type="application/x-shockwave-flash" />'))}})},function(e){var t=e.preview,n=!!e.options["autoplay"],r={"audio/mpeg":"mp3","audio/mpeg3":"mp3","audio/mp3":"mp3","audio/x-mpeg3":"mp3","audio/x-mp3":"mp3","audio/x-wav":"wav","audio/wav":"wav","audio/x-m4a":"m4a","audio/aac":"m4a","audio/mp4":"m4a","audio/x-mp4":"m4a","audio/ogg":"ogg"},i;t.bind("update",function(s){var o=s.file,u=r[o.mime];if(e.support.audio[u]){s.stopImmediatePropagation();i=$('<audio class="elfinder-quicklook-preview-audio" controls preload="auto" autobuffer><source src="'+e.fm.url(o.hash)+'" /></audio>').appendTo(t);n&&i[0].play()}}).bind("change",function(){if(i&&i.parent().length){i[0].pause();i.remove();i=null}})},function(e){var t=e.preview,n=!!e.options["autoplay"],r={"video/mp4":"mp4","video/x-m4v":"mp4","video/ogg":"ogg","application/ogg":"ogg","video/webm":"webm"},i;t.bind("update",function(s){var o=s.file,u=r[o.mime];if(e.support.video[u]){s.stopImmediatePropagation();e.hideinfo();i=$('<video class="elfinder-quicklook-preview-video" controls preload="auto" autobuffer><source src="'+e.fm.url(o.hash)+'" /></video>').appendTo(t);n&&i[0].play()}}).bind("change",function(){if(i&&i.parent().length){i[0].pause();i.remove();i=null}})},function(e){var t=e.preview,n=[],r;$.each(navigator.plugins,function(e,t){$.each(t,function(e,t){(t.type.indexOf("audio/")===0||t.type.indexOf("video/")===0)&&n.push(t.type)})});t.bind("update",function(i){var s=i.file,o=s.mime,u;if($.inArray(s.mime,n)!==-1){i.stopImmediatePropagation();(u=o.indexOf("video/")===0)&&e.hideinfo();r=$('<embed src="'+e.fm.url(s.hash)+'" type="'+o+'" class="elfinder-quicklook-preview-'+(u?"video":"audio")+'"/>').appendTo(t)}}).bind("change",function(){if(r&&r.parent().length){r.remove();r=null}})}];elFinder.prototype.commands.reload=function(){this.alwaysEnabled=true;this.updateOnSelect=true;this.shortcuts=[{pattern:"ctrl+shift+r f5"}];this.getstate=function(){return 0};this.exec=function(){var e=this.fm,t=e.sync(),n=setTimeout(function(){e.notify({type:"reload",cnt:1,hideCnt:true});t.always(function(){e.notify({type:"reload",cnt:-1})})},e.notifyDelay);return t.always(function(){clearTimeout(n);e.trigger("reload")})}};elFinder.prototype.commands.rename=function(){this.shortcuts=[{pattern:"f2"+(this.fm.OS=="mac"?" enter":"")}];this.getstate=function(){var e=this.fm.selectedFiles();return!this._disabled&&e.length==1&&e[0].phash&&!e[0].locked?0:-1};this.exec=function(){var e=this.fm,t=e.getUI("cwd"),n=e.selected(),r=n.length,i=e.file(n.shift()),s=".elfinder-cwd-filename",o=$.Deferred().fail(function(n){var r=u.parent(),o=e.escape(i.name);if(r.length){u.remove();r.html(o)}else{t.find("#"+i.hash).find(s).html(o);setTimeout(function(){t.find("#"+i.hash).click()},50)}n&&e.error(n)}).always(function(){e.enable()}),u=$('<input type="text"/>').keydown(function(e){e.stopPropagation();e.stopImmediatePropagation();if(e.keyCode==$.ui.keyCode.ESCAPE){o.reject()}else if(e.keyCode==$.ui.keyCode.ENTER){u.blur()}}).mousedown(function(e){e.stopPropagation()}).dblclick(function(e){e.stopPropagation();e.preventDefault()}).blur(function(){var t=$.trim(u.val()),n=u.parent();if(n.length){if(u[0].setSelectionRange){u[0].setSelectionRange(0,0)}if(t==i.name){return o.reject()}if(!t){return o.reject("errInvName")}if(e.fileByName(t,i.phash)){return o.reject(["errExists",t])}n.html(e.escape(t));e.lockfiles({files:[i.hash]});e.request({data:{cmd:"rename",target:i.hash,name:t},notify:{type:"rename",cnt:1}}).fail(function(t){o.reject();e.sync()}).done(function(e){o.resolve(e)}).always(function(){e.unlockfiles({files:[i.hash]})})}}),a=t.find("#"+i.hash).find(s).empty().append(u.val(i.name)),f=u.val().replace(/\.((tar\.(gz|bz|bz2|z|lzo))|cpio\.gz|ps\.gz|xcf\.(gz|bz2)|[a-z0-9]{1,4})$/ig,"");if(this.disabled()){return o.reject()}if(!i||r>1||!a.length){return o.reject("errCmdParams",this.title)}if(i.locked){return o.reject(["errLocked",i.name])}e.one("select",function(){u.parent().length&&i&&$.inArray(i.hash,e.selected())===-1&&u.blur()});u.select().focus();u[0].setSelectionRange&&u[0].setSelectionRange(0,f.length);return o}};elFinder.prototype.commands.resize=function(){this.updateOnSelect=false;this.getstate=function(){var e=this.fm.selectedFiles();return!this._disabled&&e.length==1&&e[0].read&&e[0].write&&e[0].mime.indexOf("image/")!==-1?0:-1};this.exec=function(e){var t=this.fm,n=this.files(e),r=$.Deferred(),i=function(e,n){var i=$('<div class="elfinder-dialog-resize"/>'),s='<input type="text" size="5"/>',o='<div class="elfinder-resize-row"/>',u='<div class="elfinder-resize-label"/>',a=$('<div class="elfinder-resize-control"/>'),f=$('<div class="elfinder-resize-preview"/>'),l=$('<div class="elfinder-resize-spinner">'+t.i18n("ntfloadimg")+"</div>"),c=$('<div class="elfinder-resize-handle"/>'),h=$('<div class="elfinder-resize-handle"/>'),p=$('<div class="elfinder-resize-uiresize"/>'),d=$('<div class="elfinder-resize-uicrop"/>'),v='<div class="ui-widget-content ui-corner-all elfinder-buttonset"/>',m='<div class="ui-state-default elfinder-button"/>',g='<span class="ui-widget-content elfinder-toolbar-button-separator"/>',y=$('<div class="elfinder-resize-rotate"/>'),b=$(m).attr("title",t.i18n("rotate-cw")).append($('<span class="elfinder-button-icon elfinder-button-icon-rotate-l"/>').click(function(){z=z-90;Z.update(z)})),w=$(m).attr("title",t.i18n("rotate-ccw")).append($('<span class="elfinder-button-icon elfinder-button-icon-rotate-r"/>').click(function(){z=z+90;Z.update(z)})),E=$("<span />"),S=$('<div class="ui-state-default ui-corner-all elfinder-resize-reset"><span class="ui-icon ui-icon-arrowreturnthick-1-w"/></div>'),x=$('<div class="elfinder-resize-type"/>').append('<input type="radio" name="type" id="'+n+'-resize" value="resize" checked="checked" /><label for="'+n+'-resize">'+t.i18n("resize")+"</label>").append('<input type="radio" name="type" id="'+n+'-crop" value="crop" /><label for="'+n+'-crop">'+t.i18n("crop")+"</label>").append('<input type="radio" name="type" id="'+n+'-rotate" value="rotate" /><label for="'+n+'-rotate">'+t.i18n("rotate")+"</label>"),T=$("input",x).attr("disabled","disabled").change(function(){var e=$("input:checked",x).val();Q();et(true);tt(true);nt(true);if(e=="resize"){p.show();y.hide();d.hide();et()}else if(e=="crop"){y.hide();p.hide();d.show();tt()}else if(e=="rotate"){p.hide();d.hide();y.show();nt()}}),N=$('<input type="checkbox" checked="checked"/>').change(function(){F=!!N.prop("checked");G.fixHeight();et(true);et()}),C=$(s).change(function(){var e=parseInt(C.val()),t=parseInt(F?Math.round(e/P):k.val());if(e>0&&t>0){G.updateView(e,t);k.val(t)}}),k=$(s).change(function(){var e=parseInt(k.val()),t=parseInt(F?Math.round(e*P):C.val());if(t>0&&e>0){G.updateView(t,e);C.val(t)}}),L=$(s).change(function(){Y.updateView()}),A=$(s).change(function(){Y.updateView()}),O=$(s).change(function(){Y.updateView()}),M=$(s).change(function(){Y.updateView()}),_=$('<input type="text" size="3" maxlength="3" value="0" />').change(function(){Z.update()}),D=$('<div class="elfinder-resize-rotate-slider"/>').slider({min:0,max:359,value:_.val(),animate:true,change:function(e,t){if(t.value!=D.slider("value")){Z.update(t.value)}},slide:function(e,t){Z.update(t.value,false)}}),P=1,H=1,B=0,j=0,F=true,I=0,q=0,R=0,U=0,z=0,W=$("<img/>").load(function(){l.remove();B=W.width();j=W.height();P=B/j;G.updateView(B,j);c.append(W.show()).show();C.val(B);k.val(j);var e=Math.min(I,q)/Math.sqrt(Math.pow(B,2)+Math.pow(j,2));R=B*e;U=j*e;T.button("enable");a.find("input,select").removeAttr("disabled").filter(":text").keydown(function(e){var n=e.keyCode,r;e.stopPropagation();if(n>=37&&n<=40||n==$.ui.keyCode.BACKSPACE||n==$.ui.keyCode.DELETE||n==65&&(e.ctrlKey||e.metaKey)||n==27){return}if(n==9){r=$(this).parent()[e.shiftKey?"prev":"next"](".elfinder-resize-row").children(":text");if(r.length){r.focus()}else{$(this).parent().parent().find(":text:"+(e.shiftKey?"last":"first")).focus()}}if(n==13){t.confirm({title:$("input:checked",x).val(),text:"confirmReq",accept:{label:"btnApply",callback:function(){rt()}},cancel:{label:"btnCancel",callback:function(){}}});return}if(!(n>=48&&n<=57||n>=96&&n<=105)){e.preventDefault()}}).filter(":first").focus();et();S.hover(function(){S.toggleClass("ui-state-hover")}).click(Q)}).error(function(){l.text("Unable to load image").css("background","transparent")}),X=$("<div/>"),V=$("<img/>"),J=$("<div/>"),K=$("<img/>"),Q=function(){C.val(B);k.val(j);G.updateView(B,j)},G={update:function(){C.val(Math.round(W.width()/H));k.val(Math.round(W.height()/H))},updateView:function(e,t){if(e>I||t>q){if(e/I>t/q){H=I/e;W.width(I).height(Math.ceil(t*H))}else{H=q/t;W.height(q).width(Math.ceil(e*H))}}else{W.width(e).height(t)}H=W.width()/e;E.text("1 : "+(1/H).toFixed(2));G.updateHandle()},updateHandle:function(){c.width(W.width()).height(W.height())},fixWidth:function(){var e,t;if(F){t=k.val();t=Math.round(t*P);G.updateView(e,t);C.val(e)}},fixHeight:function(){var e,t;if(F){e=C.val();t=Math.round(e/P);G.updateView(e,t);k.val(t)}}},Y={update:function(){O.val(Math.round((h.data("w")||h.width())/H));M.val(Math.round((h.data("h")||h.height())/H));L.val(Math.round(((h.data("x")||h.offset().left)-V.offset().left)/H));A.val(Math.round(((h.data("y")||h.offset().top)-V.offset().top)/H))},updateView:function(){var e=parseInt(L.val())*H+V.offset().left;var t=parseInt(A.val())*H+V.offset().top;var n=O.val()*H;var r=M.val()*H;h.data({x:e,y:t,w:n,h:r});h.width(Math.round(n));h.height(Math.round(r));J.width(h.width());J.height(h.height());h.offset({left:Math.round(e),top:Math.round(t)})},resize_update:function(){h.data({w:null,h:null});Y.update();J.width(h.width());J.height(h.height())},drag_update:function(){h.data({x:null,y:null});Y.update()}},Z={mouseStartAngle:0,imageStartAngle:0,imageBeingRotated:false,update:function(e,n){if(typeof e=="undefined"){z=e=parseInt(_.val())}if(typeof n=="undefined"){n=true}if(!n||t.UA.Opera||t.UA.ltIE8){K.rotate(e)}else{K.animate({rotate:e+"deg"})}e=e%360;if(e<0){e+=360}_.val(parseInt(e));D.slider("value",_.val())},execute:function(e){if(!Z.imageBeingRotated)return;var t=Z.getCenter(K);var n=e.pageX-t[0];var r=e.pageY-t[1];var i=Math.atan2(r,n);var s=i-Z.mouseStartAngle+Z.imageStartAngle;s=Math.round(parseFloat(s)*180/Math.PI);if(e.shiftKey){s=Math.round((s+6)/15)*15}K.rotate(s);s=s%360;if(s<0){s+=360}_.val(s);D.slider("value",_.val());return false},start:function(e){Z.imageBeingRotated=true;var t=Z.getCenter(K);var n=e.pageX-t[0];var r=e.pageY-t[1];Z.mouseStartAngle=Math.atan2(r,n);Z.imageStartAngle=parseFloat(K.rotate())*Math.PI/180;$(document).mousemove(Z.execute);return false},stop:function(e){if(!Z.imageBeingRotated)return;$(document).unbind("mousemove",Z.execute);setTimeout(function(){Z.imageBeingRotated=false},10);return false},getCenter:function(e){var t=K.rotate();K.rotate(0);var n=K.offset();var r=n.left+K.width()/2;var i=n.top+K.height()/2;K.rotate(t);return Array(r,i)}},et=function(e){if($.fn.resizable){if(e){c.filter(":ui-resizable").resizable("destroy");c.hide()}else{c.show();c.resizable({alsoResize:W,aspectRatio:F,resize:G.update,stop:G.fixHeight})}}},tt=function(e){if($.fn.draggable&&$.fn.resizable){if(e){h.filter(":ui-resizable").resizable("destroy");h.filter(":ui-draggable").draggable("destroy");X.hide()}else{V.width(W.width()).height(W.height());J.width(W.width()).height(W.height());h.width(V.width()).height(V.height()).offset(V.offset()).resizable({containment:X,resize:Y.resize_update,handles:"all"}).draggable({handle:J,containment:V,drag:Y.drag_update});X.show().width(W.width()).height(W.height());Y.update()}}},nt=function(e){if($.fn.draggable&&$.fn.resizable){if(e){K.hide()}else{K.show().width(R).height(U).css("margin-top",(q-U)/2+"px").css("margin-left",(I-R)/2+"px")}}},rt=function(){var n,s,o,u,a;var f=$("input:checked",x).val();if(f=="resize"){n=parseInt(C.val())||0;s=parseInt(k.val())||0}else if(f=="crop"){n=parseInt(O.val())||0;s=parseInt(M.val())||0;o=parseInt(L.val())||0;u=parseInt(A.val())||0}else if(f=="rotate"){n=B;s=j;a=parseInt(_.val())||0;if(a<0||a>360){return t.error("Invalid rotate degree")}if(a==0||a==360){return t.error("Image dose not rotated")}}if(f!="rotate"){if(n<=0||s<=0){return t.error("Invalid image size")}if(n==B&&s==j){return t.error("Image size not changed")}}i.elfinderdialog("close");t.request({data:{cmd:"resize",target:e.hash,width:n,height:s,x:o,y:u,degree:a,mode:f},notify:{type:"resize",cnt:1}}).fail(function(e){r.reject(e)}).done(function(){r.resolve()})},it={},st="elfinder-resize-handle-hline",ot="elfinder-resize-handle-vline",ut="elfinder-resize-handle-point",at=t.url(e.hash);K.mousedown(Z.start);$(document).mouseup(Z.stop);p.append($(o).append($(u).text(t.i18n("width"))).append(C).append(S)).append($(o).append($(u).text(t.i18n("height"))).append(k)).append($(o).append($("<label/>").text(t.i18n("aspectRatio")).prepend(N))).append($(o).append(t.i18n("scale")+" ").append(E));d.append($(o).append($(u).text("X")).append(L)).append($(o).append($(u).text("Y")).append(A)).append($(o).append($(u).text(t.i18n("width"))).append(O)).append($(o).append($(u).text(t.i18n("height"))).append(M));y.append($(o).append($(u).text(t.i18n("rotate"))).append($('<div style="float:left; width: 130px;">').append($('<div style="float:left;">').append(_).append($("<span/>").text(t.i18n("degree")))).append($(v).append(b).append($(g)).append(w))).append(D));i.append(x);a.append($(o)).append(p).append(d.hide()).append(y.hide()).find("input,select").attr("disabled","disabled");c.append('<div class="'+st+" "+st+'-top"/>').append('<div class="'+st+" "+st+'-bottom"/>').append('<div class="'+ot+" "+ot+'-left"/>').append('<div class="'+ot+" "+ot+'-right"/>').append('<div class="'+ut+" "+ut+'-e"/>').append('<div class="'+ut+" "+ut+'-se"/>').append('<div class="'+ut+" "+ut+'-s"/>');f.append(l).append(c.hide()).append(W.hide());h.css("position","absolute").append('<div class="'+st+" "+st+'-top"/>').append('<div class="'+st+" "+st+'-bottom"/>').append('<div class="'+ot+" "+ot+'-left"/>').append('<div class="'+ot+" "+ot+'-right"/>').append('<div class="'+ut+" "+ut+'-n"/>').append('<div class="'+ut+" "+ut+'-e"/>').append('<div class="'+ut+" "+ut+'-s"/>').append('<div class="'+ut+" "+ut+'-w"/>').append('<div class="'+ut+" "+ut+'-ne"/>').append('<div class="'+ut+" "+ut+'-se"/>').append('<div class="'+ut+" "+ut+'-sw"/>').append('<div class="'+ut+" "+ut+'-nw"/>');f.append(X.css("position","absolute").hide().append(V).append(h.append(J)));f.append(K.hide());f.css("overflow","hidden");i.append(f).append(a);it[t.i18n("btnApply")]=rt;it[t.i18n("btnCancel")]=function(){i.elfinderdialog("close")};t.dialog(i,{title:e.name,width:650,resizable:false,destroyOnClose:true,buttons:it,open:function(){f.zIndex(1+$(this).parent().zIndex())}}).attr("id",n);if(t.UA.ltIE8){$(".elfinder-dialog").css("filter","")}S.css("left",C.position().left+C.width()+12);J.css({opacity:.2,"background-color":"#fff",position:"absolute"}),h.css("cursor","move");h.find(".elfinder-resize-handle-point").css({"background-color":"#fff",opacity:.5,"border-color":"#000"});K.css("cursor","pointer");x.buttonset();I=f.width()-(c.outerWidth()-c.width());q=f.height()-(c.outerHeight()-c.height());W.attr("src",at+(at.indexOf("?")===-1?"?":"&")+"_="+Math.random());V.attr("src",W.attr("src"));K.attr("src",W.attr("src"))},s,o;if(!n.length||n[0].mime.indexOf("image/")===-1){return r.reject()}s="resize-"+t.namespace+"-"+n[0].hash;o=t.getUI().find("#"+s);if(o.length){o.elfinderdialog("toTop");return r.resolve()}i(n[0],s);return r}};(function(e){var t=function(e,t){var n=0;for(n in t){if(typeof e[t[n]]!="undefined")return t[n]}e[t[n]]="";return t[n]};e.cssHooks.rotate={get:function(t,n,r){return e(t).rotate()},set:function(t,n){e(t).rotate(n);return n}};e.cssHooks.transform={get:function(e,n,r){var i=t(e.style,["WebkitTransform","MozTransform","OTransform","msTransform","transform"]);return e.style[i]},set:function(e,n){var r=t(e.style,["WebkitTransform","MozTransform","OTransform","msTransform","transform"]);e.style[r]=n;return n}};e.fn.rotate=function(e){if(typeof e=="undefined"){if(!!window.opera){var t=this.css("transform").match(/rotate\((.*?)\)/);return t&&t[1]?Math.round(parseFloat(t[1])*180/Math.PI):0}else{var t=this.css("transform").match(/rotate\((.*?)\)/);return t&&t[1]?parseInt(t[1]):0}}this.css("transform",this.css("transform").replace(/none|rotate\(.*?\)/,"")+"rotate("+parseInt(e)+"deg)");return this};e.fx.step.rotate=function(t){if(t.state==0){t.start=e(t.elem).rotate();t.now=t.start}e(t.elem).rotate(t.now)};if(typeof window.addEventListener=="undefined"&&typeof document.getElementsByClassName=="undefined"){var n=function(e){var t=e;var n=t.offsetLeft;var r=t.offsetTop;while(t.offsetParent){t=t.offsetParent;if(t!=document.body&&t.currentStyle["position"]!="static"){break}if(t!=document.body&&t!=document.documentElement){n-=t.scrollLeft;r-=t.scrollTop}n+=t.offsetLeft;r+=t.offsetTop}return{x:n,y:r}};var r=function(e){if(e.currentStyle["position"]!="static"){return}var t=n(e);e.style.position="absolute";e.style.left=t.x+"px";e.style.top=t.y+"px"};var i=function(e,t){var n;var i=1;var s=1;var o=1;var u=1;if(typeof e.style["msTransform"]!="undefined"){return true}r(e);n=t.match(/rotate\((.*?)\)/);var a=n&&n[1]?parseInt(n[1]):0;a=a%360;if(a<0)a=360+a;var f=a*Math.PI/180;var l=Math.cos(f);var c=Math.sin(f);i*=l;s*=-c;o*=c;u*=l;e.style.filter=(e.style.filter||"").replace(/progid:DXImageTransform\.Microsoft\.Matrix\([^)]*\)/,"")+("progid:DXImageTransform.Microsoft.Matrix("+"M11="+i+",M12="+s+",M21="+o+",M22="+u+",FilterType='bilinear',sizingMethod='auto expand')");var h=parseInt(e.style.width||e.width||0);var p=parseInt(e.style.height||e.height||0);var f=a*Math.PI/180;var d=Math.abs(Math.cos(f));var v=Math.abs(Math.sin(f));var m=(h-(h*d+p*v))/2;var g=(p-(h*v+p*d))/2;e.style.marginLeft=Math.floor(m)+"px";e.style.marginTop=Math.floor(g)+"px";return true};var s=e.cssHooks.transform.set;e.cssHooks.transform.set=function(e,t){s.apply(this,[e,t]);i(e,t);return t}}})(jQuery);elFinder.prototype.commands.rm=function(){this.shortcuts=[{pattern:"delete ctrl+backspace"}];this.getstate=function(e){var t=this.fm;e=e||t.selected();return!this._disabled&&e.length&&$.map(e,function(e){var n=t.file(e);return n&&n.phash&&!n.locked?e:null}).length==e.length?0:-1};this.exec=function(e){var t=this,n=this.fm,r=$.Deferred().fail(function(e){e&&n.error(e)}),i=this.files(e),s=i.length,o=n.cwd().hash,u=false;if(!s||this._disabled){return r.reject()}$.each(i,function(e,t){if(!t.phash){return!r.reject(["errRm",t.name,"errPerm"])}if(t.locked){return!r.reject(["errLocked",t.name])}if(t.hash==o){u=n.root(t.hash)}});if(r.state()=="pending"){i=this.hashes(e);n.confirm({title:t.title,text:"confirmRm",accept:{label:"btnRm",callback:function(){n.lockfiles({files:i});n.request({data:{cmd:"rm",targets:i},notify:{type:"rm",cnt:s},preventFail:true}).fail(function(e){r.reject(e)}).done(function(e){r.done(e);u&&n.exec("open",u)}).always(function(){n.unlockfiles({files:i})})}},cancel:{label:"btnCancel",callback:function(){r.reject()}}})}return r}};elFinder.prototype.commands.search=function(){this.title="Find files";this.options={ui:"searchbutton"};this.alwaysEnabled=true;this.updateOnSelect=false;this.getstate=function(){return 0};this.exec=function(e){var t=this.fm;if(typeof e=="string"&&e){t.trigger("searchstart",{query:e});return t.request({data:{cmd:"search",q:e},notify:{type:"search",cnt:1,hideCnt:true}})}t.getUI("toolbar").find("."+t.res("class","searchbtn")+" :text").focus();return $.Deferred().reject()}};elFinder.prototype.commands.sort=function(){this.options={ui:"sortbutton"};this.getstate=function(){return 0};this.exec=function(e,t){var n=this.fm,t=$.extend({type:n.sortType,order:n.sortOrder,stick:n.sortStickFolders},t);this.fm.setSort(t.type,t.order,t.stick);return $.Deferred().resolve()}};elFinder.prototype.commands.up=function(){this.alwaysEnabled=true;this.updateOnSelect=false;this.shortcuts=[{pattern:"ctrl+up"}];this.getstate=function(){return this.fm.cwd().phash?0:-1};this.exec=function(){return this.fm.cwd().phash?this.fm.exec("open",this.fm.cwd().phash):$.Deferred().reject()}};elFinder.prototype.commands.upload=function(){var e=this.fm.res("class","hover");this.disableOnSearch=true;this.updateOnSelect=false;this.shortcuts=[{pattern:"ctrl+u"}];this.getstate=function(){return!this._disabled&&this.fm.cwd().write?0:-1};this.exec=function(t){var n=this.fm,r=function(e){s.elfinderdialog("close");n.upload(e).fail(function(e){i.reject(e)}).done(function(e){i.resolve(e)})},i,s,o,u,a;if(this.disabled()){return $.Deferred().reject()}if(t&&(t.input||t.files)){return n.upload(t)}i=$.Deferred();o=$('<input type="file" multiple="true"/>').change(function(){r({input:o[0]})});u=$('<div class="ui-button ui-widget ui-state-default ui-corner-all ui-button-text-only"><span class="ui-button-text">'+n.i18n("selectForUpload")+"</span></div>").append($("<form/>").append(o)).hover(function(){u.toggleClass(e)});s=$('<div class="elfinder-upload-dialog-wrapper"/>').append(u);if(n.dragUpload){a=$('<div class="ui-corner-all elfinder-upload-dropbox">'+n.i18n("dropFiles")+"</div>").prependTo(s).after('<div class="elfinder-upload-dialog-or">'+n.i18n("or")+"</div>")[0];a.addEventListener("dragenter",function(t){t.stopPropagation();t.preventDefault();$(a).addClass(e)},false);a.addEventListener("dragleave",function(t){t.stopPropagation();t.preventDefault();$(a).removeClass(e)},false);a.addEventListener("dragover",function(e){e.stopPropagation();e.preventDefault()},false);a.addEventListener("drop",function(e){e.stopPropagation();e.preventDefault();r({files:e.dataTransfer.files})},false)}n.dialog(s,{title:this.title,modal:true,resizable:false,destroyOnClose:true});return i}};elFinder.prototype.commands.view=function(){this.value=this.fm.viewType;this.alwaysEnabled=true;this.updateOnSelect=false;this.options={ui:"viewbutton"};this.getstate=function(){return 0};this.exec=function(){var e=this.fm.storage("view",this.value=="list"?"icons":"list");this.fm.viewchange();this.update(void 0,e)}}